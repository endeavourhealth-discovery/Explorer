  <div mat-dialog-title>
    Query and data set editor
  </div>

  <mat-horizontal-stepper #stepper style="font-size: 14px">

    <mat-step [stepControl]="firstFormGroup" errorMessage="Step not completed.">
      <form [formGroup]="firstFormGroup">
        <ng-template matStepLabel>Query name</ng-template>
        <br/>
        <div class="summary-column">
          <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <mat-form-field appearance="outline" style="margin-left: 25px; width: 600px">
              <mat-label>Query folder</mat-label>
              <input required matInput placeholder="Folder" [(ngModel)]="type" formControlName="control1" (ngModelChange)="formChanged()" (keydown.enter)="stepper.next()">
            </mat-form-field>
          </div>
          <br/>
          <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <mat-form-field appearance="outline" style="margin-left: 25px; width: 600px">
              <mat-label>Query name</mat-label>
              <input required matInput placeholder="Name" [(ngModel)]="name" formControlName="control2" (ngModelChange)="formChanged()" (keydown.enter)="stepper.next()">
            </mat-form-field>
          </div>
          <br/>
          <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <mat-form-field appearance="outline" style="margin-left: 25px; width: 600px">
              <mat-label>Registry name</mat-label>
              <input maxlength="60" required matInput placeholder="Registry" [(ngModel)]="registryName" formControlName="control159" (ngModelChange)="formChanged()" (keydown.enter)="stepper.next()">
            </mat-form-field>
          </div>
          <br/>
          <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <mat-form-field appearance="outline" style="margin-left: 25px; width: 600px">
              <mat-label>Denominator query</mat-label>
              <mat-select [(ngModel)]="denominatorQuery" formControlName="control157" (ngModelChange)="formChanged()">
                <mat-select-search [formControl]="filterQueryCtrl"></mat-select-search>
                <mat-option *ngFor="let result of filteredQueryList | async" [value]="result" matTooltipClass="tooltip" matTooltipPosition="right" matTooltip="{{result}}">
                  {{result}}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <br/>
          <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <mat-form-field appearance="outline" style="margin-left: 25px; width: 100px">
              <mat-label>Target %</mat-label>
              <input matInput placeholder="Target %" [(ngModel)]="targetPercentage" formControlName="control158" (ngModelChange)="formChanged()" (keydown.enter)="stepper.next()">
            </mat-form-field>
          </div>
          <br/>
          <span style="margin-left: 30px">*Required</span>
        </div>
        <div class="summary-column">
          <div style="margin-top: 7px" class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <p>Folder for grouping query in the library.</p>
          </div>
          <div style="margin-top: 30px" class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <p>Name of query.</p>
          </div>
          <div style="margin-top: 27px" class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <p>Please enter an abbreviated name for the registry that will appear as a column in the Registries module.</p>
          </div>
          <div style="margin-top: 5px" class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <p>Select an (optional) query as the denominator for this query. This queryâ€™s patient cohort (numerator) will then be compared against the selected denominator query cohort in the registries results.</p>
          </div>
          <div style="margin-top: 15px" class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <p>Target threshold for the numerator against the denominator patient cohort.</p>
          </div>
        </div>
        <div style="margin-top: 285px" mat-dialog-actions align="end">
          <button style="margin-right: 15px" mat-button color="accent" (click)="onCancelClick()">Cancel</button>
          <button style="margin-right: 15px" mat-flat-button color="accent" (click)="stepper.next()">Next</button>
          <button style="margin-right: 15px" mat-flat-button color="accent" [disabled]="disableForm" (click)="saveQuery()">Save</button>
        </div>
      </form>
    </mat-step>

    <mat-step [stepControl]="secondFormGroup" errorMessage="Step not completed.">
      <form [formGroup]="secondFormGroup">
        <ng-template matStepLabel>Cohort definition</ng-template>
        <br/>
        <div class="summary-column">
          <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <mat-form-field appearance="outline" style="margin-left: 25px; width: 450px">
              <mat-label>Provider organisations</mat-label>
              <mat-select multiple [(ngModel)]="selectedOrganisation" formControlName="control3" (ngModelChange)="formChanged()" required>
                <mat-option *ngFor="let result of orgList" [value]="result">{{result}}</mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <br/>
          <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <mat-form-field appearance="outline" style="margin-left: 25px; width: 450px">
              <mat-label>Included organisations</mat-label>
              <mat-select multiple [(ngModel)]="selectedIncludedOrganisation" formControlName="control17" (ngModelChange)="formChanged()">
                <mat-option *ngFor="let result of orgIncList" [value]="result">{{result}}</mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <br/>
          <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <mat-form-field appearance="outline" style="margin-left: 25px; width: 450px">
              <mat-label>Patient GP registration status</mat-label>
              <mat-select [(ngModel)]="selectedRegistration" formControlName="control4" (ngModelChange)="formChanged()" required>
                <mat-option *ngFor="let registration of registrations" [value]="registration.regValue">
                  {{registration.regValue}}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <br/>
          <div class="flex" fxLayout.xs="column"  fxLayoutAlign="start">
            <mat-form-field appearance="outline" style="margin-left: 25px; width: 155px">
              <mat-label>Include/Exclude</mat-label>
              <mat-select [(ngModel)]="registrationExclude" formControlName="control5" (ngModelChange)="formChanged()">
                <mat-option *ngFor="let value of exclude" [value]="value.exclude">
                  {{value.exclude}}
                </mat-option>
              </mat-select>
            </mat-form-field>
            <p style="margin-left:10px; margin-top: 20px"> patients who registered within the last</p>
            <br/>
          </div>
          <div class="flex" fxLayout.xs="column"  fxLayoutAlign="start">
            <mat-form-field appearance="outline" style="margin-left: 25px; width: 80px">
              <input matInput placeholder="Value" [(ngModel)]="registrationPeriodValue" formControlName="control5a" (keydown.enter)="stepper.next()">
            </mat-form-field>
            <mat-form-field appearance="outline" style="margin-left: 10px; width: 170px">
              <mat-label>Days/Weeks/Months</mat-label>
              <mat-select [(ngModel)]="registrationPeriodType" formControlName="control5b" (ngModelChange)="formChanged()">
                <mat-option *ngFor="let value of period" [value]="value.period">
                  {{value.period}}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <p style="margin-left:25px"> or within the registration date range from</p>
          <div class="flex" fxLayout.xs="column"  fxLayoutAlign="start">
            <mat-form-field class="example-full-width" appearance="outline" style="margin-left: 25px; width: 150px">
              <mat-label>Date range from</mat-label>
              <input matInput [matDatepicker]="valuepicker1" placeholder="Date from" [(ngModel)]="registrationDateFrom" formControlName="control20">
              <mat-datepicker-toggle matSuffix [for]="valuepicker1">
                <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
              </mat-datepicker-toggle>
              <mat-datepicker #valuepicker1></mat-datepicker>
            </mat-form-field>

            <mat-form-field class="example-full-width" appearance="outline" style="margin-left: 20px; width: 150px">
              <mat-label>Date range to</mat-label>
              <input matInput [matDatepicker]="valuepicker2" placeholder="Date to" [(ngModel)]="registrationDateTo" formControlName="control21">
              <mat-datepicker-toggle matSuffix [for]="valuepicker2">
                <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
              </mat-datepicker-toggle>
              <mat-datepicker #valuepicker2></mat-datepicker>
            </mat-form-field>
          </div>

          <br/>
          <div class="flex" fxLayout.xs="column"  fxLayoutAlign="start">
            <mat-form-field appearance="outline" style="margin-left: 25px; width: 140px">
              <mat-label>Age range from</mat-label>
              <input matInput placeholder="Age" [(ngModel)]="ageFrom" formControlName="control6" (keydown.enter)="stepper.next()">
            </mat-form-field>

            <mat-form-field appearance="outline" style="margin-left: 20px; width: 140px">
              <mat-label>Age range to</mat-label>
              <input matInput placeholder="Age" [(ngModel)]="ageTo" formControlName="control7" (keydown.enter)="stepper.next()">
            </mat-form-field>
          </div>
          <br/>
          <div class="flex" fxLayout.xs="column"  fxLayoutAlign="start">
            <mat-form-field appearance="outline" style="margin-left: 25px; width: 100px">
              <mat-label>Gender</mat-label>
              <mat-select [(ngModel)]="selectedGender" formControlName="control8">
                <mat-option *ngFor="let gender of genders" [value]="gender.genValue">
                  {{gender.genValue}}
                </mat-option>
              </mat-select>
            </mat-form-field>

            <mat-form-field appearance="outline" style="margin-left: 20px; width: 180px">
              <mat-label>Home address postcode</mat-label>
              <input matInput placeholder="Postcode" [(ngModel)]="postcode" formControlName="control9" (keydown.enter)="stepper.next()">
            </mat-form-field>
          </div>
          <br/>
          <span style="margin-left: 30px">*Required</span>
        </div>

        <div class="summary-column">
          <div style="margin-top: 20px" class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            List of organisations, or list of organisation groups, whose records will be used as the base cohort.
          </div>

          <div style="margin-top: 35px" class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            This is the list of organisations whose records are included for the patients in the base cohort. For example, patients who have records in a GP practice might be in the cohort base, they might have visited hospital and the hospital could also be included in the included organisation list. If an organisation is not defined, those organisations records are not included.
          </div>

        </div>

        <div style="margin-top: 70px" mat-dialog-actions align="end">
          <button style="margin-right: 15px" mat-button color="accent" (click)="onCancelClick()">Cancel</button>
          <button style="margin-right: 15px" mat-button color="accent" matStepperPrevious>Back</button>
          <button style="margin-right: 15px" mat-flat-button color="accent" (click)="stepper.next()">Next</button>
          <button style="margin-right: 15px" mat-flat-button color="accent" [disabled]="disableForm" (click)="saveQuery()">Save</button>
        </div>
      </form>
    </mat-step>

    <mat-step [stepControl]="thirdFormGroup" errorMessage="Step not completed.">
      <form [formGroup]="thirdFormGroup">
        <ng-template matStepLabel>Advanced cohort criteria</ng-template>
        <div class="criteria-container">
        <p style="font-weight: 500">Specify one or more of the following (optional) advanced criteria rules for identifying the patient cohort. These rules will be added to the cohort definition rules in step 2.</p>
        <mat-divider></mat-divider>
        <br/>
        <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
          <mat-form-field appearance="standard" style="margin-left: 10px; width: 125px">
            <mat-label>Include/Exclude</mat-label>
            <mat-select [(ngModel)]="includedExclude1" formControlName="control22" (ngModelChange)="formChanged()">
              <mat-option *ngFor="let value of exclude" [value]="value.exclude">
                {{value.exclude}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <br/>
          <p style="margin-left: 10px; margin-top: 28px">patients with records containing <span style="color: blue">concepts</span> matching</p>
          <mat-form-field appearance="standard" style="margin-left: 10px; width: 70px">
            <mat-label>Any/All</mat-label>
            <mat-select [(ngModel)]="includedAnyAll1" formControlName="control46" (ngModelChange)="formChanged()">
              <mat-option *ngFor="let value of anyAll" [value]="value.anyAll">
                {{value.anyAll}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <p style="margin-left: 10px; margin-top: 28px"> of the <span style="color: blue">value set(s)</span></p>
          <mat-form-field appearance="standard" style="width: 450px; margin-left: 10px">
            <mat-label>Cohort value set</mat-label>
            <mat-select multiple [(ngModel)]="includedValueSet1" formControlName="control23" (ngModelChange)="formChanged()">
              <mat-select-search [formControl]="filterCtrl"></mat-select-search>
              <mat-option *ngFor="let result of filteredValueset | async" [value]="result" matTooltipClass="tooltip" matTooltipPosition="right" matTooltip="{{result}}">
                {{result}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <br/>
          <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <p style="margin-left: 10px; margin-top: 28px"><span style="color: blue">within</span> the <span style="color: blue">time period</span></p>
            <mat-form-field class="example-full-width" appearance="standard" style="margin-left: 10px; width: 120px">
              <mat-label>Date from</mat-label>
              <input matInput [matDatepicker]="picker3" placeholder="Date from" [(ngModel)]="includedDateFrom1" formControlName="control24">
              <mat-datepicker-toggle matSuffix [for]="picker3">
                <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
              </mat-datepicker-toggle>
              <mat-datepicker #picker3></mat-datepicker>
            </mat-form-field>
            <p style="margin-left: 10px; margin-top: 28px">to</p>
            <mat-form-field class="example-full-width" appearance="standard" style="margin-left: 10px; width: 120px">
              <mat-label>Date to</mat-label>
              <input matInput [matDatepicker]="picker4" placeholder="Date to" [(ngModel)]="includedDateTo1" formControlName="control25">
              <mat-datepicker-toggle matSuffix [for]="picker4">
                <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
              </mat-datepicker-toggle>
              <mat-datepicker #picker4></mat-datepicker>
            </mat-form-field>
            <p style="margin-left: 10px; margin-top: 28px">/ </p>
            <mat-form-field appearance="standard" style="margin-left: 10px; width: 130px">
              <mat-label>Within/Before</mat-label>
              <mat-select [(ngModel)]="includedPeriodOperator1" formControlName="control147" (ngModelChange)="formChanged()">
                <mat-option *ngFor="let value of withinBefore" [value]="value.withinBefore">
                  {{value.withinBefore}}
                </mat-option>
              </mat-select>
            </mat-form-field>
            <mat-form-field appearance="standard" style="margin-left: 10px; width: 60px">
              <mat-label>Period</mat-label>
              <input matInput placeholder="Value" [(ngModel)]="includedPeriodValue1" formControlName="control47" (keydown.enter)="stepper.next()">
            </mat-form-field>
            <mat-form-field appearance="standard" style="margin-left: 10px; width: 160px">
              <mat-label>Days/Weeks/Months</mat-label>
              <mat-select [(ngModel)]="includedPeriodType1" formControlName="control48" (ngModelChange)="formChanged()">
                <mat-option *ngFor="let value of period" [value]="value.period">
                  {{value.period}}
                </mat-option>
              </mat-select>
            </mat-form-field><p style="margin-left: 10px; margin-top: 28px"> of the run date</p>
          </div>
          <div mat-dialog-actions style="margin-bottom: 10px; margin-left: 20px" *ngIf="addQuery1">
            <button mat-flat-button color="accent" (click)="addSameRule1()">Add same rule</button>
          </div>
        </div>

        <br/>
        <mat-divider></mat-divider>
        <br/>

        <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start" *ngIf="select1a">
          <mat-form-field appearance="standard" style="margin-left: 10px; width: 125px">
            <mat-label>Include/Exclude</mat-label>
            <mat-select [(ngModel)]="includedExclude1a" formControlName="control22a" (ngModelChange)="formChanged()">
              <mat-option *ngFor="let value of exclude" [value]="value.exclude">
                {{value.exclude}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <br/>
          <p style="margin-left: 10px; margin-top: 28px">patients with records containing <span style="color: blue">concepts</span> matching</p>
          <mat-form-field appearance="standard" style="margin-left: 10px; width: 70px">
            <mat-label>Any/All</mat-label>
            <mat-select [(ngModel)]="includedAnyAll1a" formControlName="control46a" (ngModelChange)="formChanged()">
              <mat-option *ngFor="let value of anyAll" [value]="value.anyAll">
                {{value.anyAll}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <p style="margin-left: 10px; margin-top: 28px"> of the <span style="color: blue">value set(s)</span></p>
          <mat-form-field appearance="standard" style="width: 450px; margin-left: 10px">
            <mat-label>Cohort value set</mat-label>
            <mat-select multiple [(ngModel)]="includedValueSet1a" formControlName="control23a" (ngModelChange)="formChanged()">
              <mat-select-search [formControl]="filterCtrl"></mat-select-search>
              <mat-option *ngFor="let result of filteredValueset | async" [value]="result" matTooltipClass="tooltip" matTooltipPosition="right" matTooltip="{{result}}">
                {{result}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <br/>
          <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <p style="margin-left: 10px; margin-top: 28px"><span style="color: blue">within</span> the <span style="color: blue">time period</span></p>
            <mat-form-field class="example-full-width" appearance="standard" style="margin-left: 10px; width: 120px">
              <mat-label>Date from</mat-label>
              <input matInput [matDatepicker]="picker3a" placeholder="Date from" [(ngModel)]="includedDateFrom1a" formControlName="control24a">
              <mat-datepicker-toggle matSuffix [for]="picker3a">
                <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
              </mat-datepicker-toggle>
              <mat-datepicker #picker3a></mat-datepicker>
            </mat-form-field>
            <p style="margin-left: 10px; margin-top: 28px">to</p>
            <mat-form-field class="example-full-width" appearance="standard" style="margin-left: 10px; width: 120px">
              <mat-label>Date to</mat-label>
              <input matInput [matDatepicker]="picker4a" placeholder="Date to" [(ngModel)]="includedDateTo1a" formControlName="control25a">
              <mat-datepicker-toggle matSuffix [for]="picker4a">
                <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
              </mat-datepicker-toggle>
              <mat-datepicker #picker4a></mat-datepicker>
            </mat-form-field>
            <p style="margin-left: 10px; margin-top: 28px">/ </p>
            <mat-form-field appearance="standard" style="margin-left: 10px; width: 130px">
              <mat-label>Within/Before</mat-label>
              <mat-select [(ngModel)]="includedPeriodOperator1a" formControlName="control148" (ngModelChange)="formChanged()">
                <mat-option *ngFor="let value of withinBefore" [value]="value.withinBefore">
                  {{value.withinBefore}}
                </mat-option>
              </mat-select>
            </mat-form-field>
            <mat-form-field appearance="standard" style="margin-left: 10px; width: 60px">
              <mat-label>Period</mat-label>
              <input matInput placeholder="Value" [(ngModel)]="includedPeriodValue1a" formControlName="control47a" (keydown.enter)="stepper.next()">
            </mat-form-field>
            <mat-form-field appearance="standard" style="margin-left: 10px; width: 160px">
              <mat-label>Days/Weeks/Months</mat-label>
              <mat-select [(ngModel)]="includedPeriodType1a" formControlName="control48a" (ngModelChange)="formChanged()">
                <mat-option *ngFor="let value of period" [value]="value.period">
                  {{value.period}}
                </mat-option>
              </mat-select>
            </mat-form-field><p style="margin-left: 10px; margin-top: 28px"> of the run date</p>
          </div>
          <div mat-dialog-actions style="margin-bottom: 10px; margin-left: 20px" *ngIf="addQuery1b">
            <button mat-flat-button color="accent" (click)="addSameRule1b()">Add same rule</button>
          </div>
        </div>

        <br *ngIf="select1a"/>
        <mat-divider *ngIf="select1a"></mat-divider>
        <br *ngIf="select1a"/>

        <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start" *ngIf="select1b">
          <mat-form-field appearance="standard" style="margin-left: 10px; width: 125px">
            <mat-label>Include/Exclude</mat-label>
            <mat-select [(ngModel)]="includedExclude1b" formControlName="control22b" (ngModelChange)="formChanged()">
              <mat-option *ngFor="let value of exclude" [value]="value.exclude">
                {{value.exclude}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <br/>
          <p style="margin-left: 10px; margin-top: 28px">patients with records containing <span style="color: blue">concepts</span> matching</p>
          <mat-form-field appearance="standard" style="margin-left: 10px; width: 70px">
            <mat-label>Any/All</mat-label>
            <mat-select [(ngModel)]="includedAnyAll1b" formControlName="control46b" (ngModelChange)="formChanged()">
              <mat-option *ngFor="let value of anyAll" [value]="value.anyAll">
                {{value.anyAll}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <p style="margin-left: 10px; margin-top: 28px"> of the <span style="color: blue">value set(s)</span></p>
          <mat-form-field appearance="standard" style="width: 450px; margin-left: 10px">
            <mat-label>Cohort value set</mat-label>
            <mat-select multiple [(ngModel)]="includedValueSet1b" formControlName="control23b" (ngModelChange)="formChanged()">
              <mat-select-search [formControl]="filterCtrl"></mat-select-search>
              <mat-option *ngFor="let result of filteredValueset | async" [value]="result" matTooltipClass="tooltip" matTooltipPosition="right" matTooltip="{{result}}">
                {{result}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <br/>
          <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <p style="margin-left: 10px; margin-top: 28px"><span style="color: blue">within</span> the <span style="color: blue">time period</span></p>
            <mat-form-field class="example-full-width" appearance="standard" style="margin-left: 10px; width: 120px">
              <mat-label>Date from</mat-label>
              <input matInput [matDatepicker]="picker3b" placeholder="Date from" [(ngModel)]="includedDateFrom1b" formControlName="control24b">
              <mat-datepicker-toggle matSuffix [for]="picker3b">
                <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
              </mat-datepicker-toggle>
              <mat-datepicker #picker3b></mat-datepicker>
            </mat-form-field>
            <p style="margin-left: 10px; margin-top: 28px">to</p>
            <mat-form-field class="example-full-width" appearance="standard" style="margin-left: 10px; width: 120px">
              <mat-label>Date to</mat-label>
              <input matInput [matDatepicker]="picker4b" placeholder="Date to" [(ngModel)]="includedDateTo1b" formControlName="control25b">
              <mat-datepicker-toggle matSuffix [for]="picker4b">
                <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
              </mat-datepicker-toggle>
              <mat-datepicker #picker4b></mat-datepicker>
            </mat-form-field>
            <p style="margin-left: 10px; margin-top: 28px">/ </p>
            <mat-form-field appearance="standard" style="margin-left: 10px; width: 130px">
              <mat-label>Within/Before</mat-label>
              <mat-select [(ngModel)]="includedPeriodOperator1b" formControlName="control149" (ngModelChange)="formChanged()">
                <mat-option *ngFor="let value of withinBefore" [value]="value.withinBefore">
                  {{value.withinBefore}}
                </mat-option>
              </mat-select>
            </mat-form-field>
            <mat-form-field appearance="standard" style="margin-left: 10px; width: 60px">
              <mat-label>Period</mat-label>
              <input matInput placeholder="Value" [(ngModel)]="includedPeriodValue1b" formControlName="control47b" (keydown.enter)="stepper.next()">
            </mat-form-field>
            <mat-form-field appearance="standard" style="margin-left: 10px; width: 160px">
              <mat-label>Days/Weeks/Months</mat-label>
              <mat-select [(ngModel)]="includedPeriodType1b" formControlName="control48b" (ngModelChange)="formChanged()">
                <mat-option *ngFor="let value of period" [value]="value.period">
                  {{value.period}}
                </mat-option>
              </mat-select>
            </mat-form-field><p style="margin-left: 10px; margin-top: 28px"> of the run date</p>
          </div>
          <div mat-dialog-actions style="margin-bottom: 10px; margin-left: 20px" *ngIf="addQuery1c">
            <button mat-flat-button color="accent" (click)="addSameRule1c()">Add same rule</button>
          </div>
        </div>

        <br *ngIf="select1b"/>
        <mat-divider *ngIf="select1b"></mat-divider>
        <br *ngIf="select1b"/>

          <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start" *ngIf="select1c">
            <mat-form-field appearance="standard" style="margin-left: 10px; width: 125px">
              <mat-label>Include/Exclude</mat-label>
              <mat-select [(ngModel)]="includedExclude1c" formControlName="control22c" (ngModelChange)="formChanged()">
                <mat-option *ngFor="let value of exclude" [value]="value.exclude">
                  {{value.exclude}}
                </mat-option>
              </mat-select>
            </mat-form-field>
            <br/>
            <p style="margin-left: 10px; margin-top: 28px">patients with records containing <span style="color: blue">concepts</span> matching</p>
            <mat-form-field appearance="standard" style="margin-left: 10px; width: 70px">
              <mat-label>Any/All</mat-label>
              <mat-select [(ngModel)]="includedAnyAll1c" formControlName="control46c" (ngModelChange)="formChanged()">
                <mat-option *ngFor="let value of anyAll" [value]="value.anyAll">
                  {{value.anyAll}}
                </mat-option>
              </mat-select>
            </mat-form-field>
            <p style="margin-left: 10px; margin-top: 28px"> of the <span style="color: blue">value set(s)</span></p>
            <mat-form-field appearance="standard" style="width: 450px; margin-left: 10px">
              <mat-label>Cohort value set</mat-label>
              <mat-select multiple [(ngModel)]="includedValueSet1c" formControlName="control23c" (ngModelChange)="formChanged()">
                <mat-select-search [formControl]="filterCtrl"></mat-select-search>
                <mat-option *ngFor="let result of filteredValueset | async" [value]="result" matTooltipClass="tooltip" matTooltipPosition="right" matTooltip="{{result}}">
                  {{result}}
                </mat-option>
              </mat-select>
            </mat-form-field>
            <br/>
            <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
              <p style="margin-left: 10px; margin-top: 28px"><span style="color: blue">within</span> the <span style="color: blue">time period</span></p>
              <mat-form-field class="example-full-width" appearance="standard" style="margin-left: 10px; width: 120px">
                <mat-label>Date from</mat-label>
                <input matInput [matDatepicker]="picker3c" placeholder="Date from" [(ngModel)]="includedDateFrom1c" formControlName="control24c">
                <mat-datepicker-toggle matSuffix [for]="picker3c">
                  <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
                </mat-datepicker-toggle>
                <mat-datepicker #picker3c></mat-datepicker>
              </mat-form-field>
              <p style="margin-left: 10px; margin-top: 28px">to</p>
              <mat-form-field class="example-full-width" appearance="standard" style="margin-left: 10px; width: 120px">
                <mat-label>Date to</mat-label>
                <input matInput [matDatepicker]="picker4c" placeholder="Date to" [(ngModel)]="includedDateTo1c" formControlName="control25c">
                <mat-datepicker-toggle matSuffix [for]="picker4c">
                  <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
                </mat-datepicker-toggle>
                <mat-datepicker #picker4c></mat-datepicker>
              </mat-form-field>
              <p style="margin-left: 10px; margin-top: 28px">/ </p>
              <mat-form-field appearance="standard" style="margin-left: 10px; width: 130px">
                <mat-label>Within/Before</mat-label>
                <mat-select [(ngModel)]="includedPeriodOperator1c" formControlName="control150" (ngModelChange)="formChanged()">
                  <mat-option *ngFor="let value of withinBefore" [value]="value.withinBefore">
                    {{value.withinBefore}}
                  </mat-option>
                </mat-select>
              </mat-form-field>
              <mat-form-field appearance="standard" style="margin-left: 10px; width: 60px">
                <mat-label>Period</mat-label>
                <input matInput placeholder="Value" [(ngModel)]="includedPeriodValue1c" formControlName="control47c" (keydown.enter)="stepper.next()">
              </mat-form-field>
              <mat-form-field appearance="standard" style="margin-left: 10px; width: 160px">
                <mat-label>Days/Weeks/Months</mat-label>
                <mat-select [(ngModel)]="includedPeriodType1c" formControlName="control48c" (ngModelChange)="formChanged()">
                  <mat-option *ngFor="let value of period" [value]="value.period">
                    {{value.period}}
                  </mat-option>
                </mat-select>
              </mat-form-field><p style="margin-left: 10px; margin-top: 28px"> of the run date</p>
            </div>
            <div mat-dialog-actions style="margin-bottom: 10px; margin-left: 20px" *ngIf="addQuery1d">
              <button mat-flat-button color="accent" (click)="addSameRule1d()">Add same rule</button>
            </div>
          </div>

          <br *ngIf="select1c"/>
          <mat-divider *ngIf="select1c"></mat-divider>
          <br *ngIf="select1c"/>

          <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start" *ngIf="select1d">
            <mat-form-field appearance="standard" style="margin-left: 10px; width: 125px">
              <mat-label>Include/Exclude</mat-label>
              <mat-select [(ngModel)]="includedExclude1d" formControlName="control22d" (ngModelChange)="formChanged()">
                <mat-option *ngFor="let value of exclude" [value]="value.exclude">
                  {{value.exclude}}
                </mat-option>
              </mat-select>
            </mat-form-field>
            <br/>
            <p style="margin-left: 10px; margin-top: 28px">patients with records containing <span style="color: blue">concepts</span> matching</p>
            <mat-form-field appearance="standard" style="margin-left: 10px; width: 70px">
              <mat-label>Any/All</mat-label>
              <mat-select [(ngModel)]="includedAnyAll1d" formControlName="control46d" (ngModelChange)="formChanged()">
                <mat-option *ngFor="let value of anyAll" [value]="value.anyAll">
                  {{value.anyAll}}
                </mat-option>
              </mat-select>
            </mat-form-field>
            <p style="margin-left: 10px; margin-top: 28px"> of the <span style="color: blue">value set(s)</span></p>
            <mat-form-field appearance="standard" style="width: 450px; margin-left: 10px">
              <mat-label>Cohort value set</mat-label>
              <mat-select multiple [(ngModel)]="includedValueSet1d" formControlName="control23d" (ngModelChange)="formChanged()">
                <mat-select-search [formControl]="filterCtrl"></mat-select-search>
                <mat-option *ngFor="let result of filteredValueset | async" [value]="result" matTooltipClass="tooltip" matTooltipPosition="right" matTooltip="{{result}}">
                  {{result}}
                </mat-option>
              </mat-select>
            </mat-form-field>
            <br/>
            <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
              <p style="margin-left: 10px; margin-top: 28px"><span style="color: blue">within</span> the <span style="color: blue">time period</span></p>
              <mat-form-field class="example-full-width" appearance="standard" style="margin-left: 10px; width: 120px">
                <mat-label>Date from</mat-label>
                <input matInput [matDatepicker]="picker3d" placeholder="Date from" [(ngModel)]="includedDateFrom1d" formControlName="control24d">
                <mat-datepicker-toggle matSuffix [for]="picker3d">
                  <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
                </mat-datepicker-toggle>
                <mat-datepicker #picker3d></mat-datepicker>
              </mat-form-field>
              <p style="margin-left: 10px; margin-top: 28px">to</p>
              <mat-form-field class="example-full-width" appearance="standard" style="margin-left: 10px; width: 120px">
                <mat-label>Date to</mat-label>
                <input matInput [matDatepicker]="picker4d" placeholder="Date to" [(ngModel)]="includedDateTo1d" formControlName="control25d">
                <mat-datepicker-toggle matSuffix [for]="picker4d">
                  <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
                </mat-datepicker-toggle>
                <mat-datepicker #picker4d></mat-datepicker>
              </mat-form-field>

              <mat-form-field appearance="standard" style="margin-left: 10px; width: 130px">
                <mat-label>Within/Before</mat-label>
                <mat-select [(ngModel)]="includedPeriodOperator1d" formControlName="control151" (ngModelChange)="formChanged()">
                  <mat-option *ngFor="let value of withinBefore" [value]="value.withinBefore">
                    {{value.withinBefore}}
                  </mat-option>
                </mat-select>
              </mat-form-field>
              <mat-form-field appearance="standard" style="margin-left: 10px; width: 60px">
                <mat-label>Period</mat-label>
                <input matInput placeholder="Value" [(ngModel)]="includedPeriodValue1d" formControlName="control47d" (keydown.enter)="stepper.next()">
              </mat-form-field>
              <mat-form-field appearance="standard" style="margin-left: 10px; width: 160px">
                <mat-label>Days/Weeks/Months</mat-label>
                <mat-select [(ngModel)]="includedPeriodType1d" formControlName="control48d" (ngModelChange)="formChanged()">
                  <mat-option *ngFor="let value of period" [value]="value.period">
                    {{value.period}}
                  </mat-option>
                </mat-select>
              </mat-form-field><p style="margin-left: 10px; margin-top: 28px"> of the run date</p>
            </div>
          </div>

          <br *ngIf="select1d"/>
          <mat-divider *ngIf="select1d"></mat-divider>
          <br *ngIf="select1d"/>

        <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
          <mat-form-field appearance="standard" style="margin-left: 10px; width: 125px">
            <mat-label>Include/Exclude</mat-label>
            <mat-select [(ngModel)]="includedExclude2" formControlName="control26" (ngModelChange)="formChanged()">
              <mat-option *ngFor="let value of exclude" [value]="value.exclude">
                {{value.exclude}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <br/>
          <p style="margin-left: 10px; margin-top: 29px">patients with records containing <span style="color: blue">concepts</span> matching</p>
          <mat-form-field appearance="standard" style="margin-left: 10px; width: 70px">
            <mat-label>Any/All</mat-label>
            <mat-select [(ngModel)]="includedAnyAll2" formControlName="control49" (ngModelChange)="formChanged()">
              <mat-option *ngFor="let value of anyAll" [value]="value.anyAll">
                {{value.anyAll}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <p style="margin-left: 10px; margin-top: 28px"> of the <span style="color: blue">value set(s)</span></p>
          <mat-form-field appearance="standard" style="width: 450px; margin-left: 10px">
            <mat-label>Cohort value set</mat-label>
            <mat-select multiple [(ngModel)]="includedValueSet2" formControlName="control27" (ngModelChange)="formChanged()">
              <mat-select-search [formControl]="filterCtrl"></mat-select-search>
              <mat-option *ngFor="let result of filteredValueset | async" [value]="result" matTooltipClass="tooltip" matTooltipPosition="right" matTooltip="{{result}}">
                {{result}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <br/>
          <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <p style="margin-left: 10px; margin-top: 29px">and the <span style="color: blue">value</span> of the</p>
            <mat-form-field appearance="standard" style="margin-left: 10px; width: 120px">
              <mat-label>Earliest/Latest</mat-label>
              <mat-select [(ngModel)]="includedEarliestLatest2" formControlName="control28" (ngModelChange)="formChanged()">
                <mat-option *ngFor="let value of earliestLatest" [value]="value.earliestLatest">
                  {{value.earliestLatest}}
                </mat-option>
              </mat-select>
            </mat-form-field>
              <p style="margin-left: 10px; margin-top: 28px"><span style="color: blue">entry</span> is</p>
            <mat-form-field appearance="standard" style="margin-left: 10px; width: 110px">
              <mat-label>Less/Greater</mat-label>
              <mat-select [(ngModel)]="includedOperator2" formControlName="control29" (ngModelChange)="formChanged()">
                <mat-option *ngFor="let value of operator" [value]="value.operator">
                  {{value.operator}}
                </mat-option>
              </mat-select>
            </mat-form-field>
            <mat-form-field appearance="standard" style="margin-left: 10px; width: 100px">
              <mat-label>Entry value</mat-label>
              <input matInput placeholder="Value" [(ngModel)]="includedEntryValue2" formControlName="control30" (keydown.enter)="stepper.next()">
            </mat-form-field>
          </div>
          <br/>
          <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <p style="margin-left: 10px; margin-top: 28px">within the <span style="color: blue">time period</span></p>
            <mat-form-field class="example-full-width" appearance="standard" style="margin-left: 10px; width: 120px">
              <mat-label>Date from</mat-label>
              <input matInput [matDatepicker]="picker9" placeholder="Date from" [(ngModel)]="includedDateFrom2" formControlName="control61">
              <mat-datepicker-toggle matSuffix [for]="picker9">
                <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
              </mat-datepicker-toggle>
              <mat-datepicker #picker9></mat-datepicker>
            </mat-form-field>
            <p style="margin-left: 10px; margin-top: 28px">to</p>
            <mat-form-field class="example-full-width" appearance="standard" style="margin-left: 10px; width: 120px">
              <mat-label>Date to</mat-label>
              <input matInput [matDatepicker]="picker10" placeholder="Date to" [(ngModel)]="includedDateTo2" formControlName="control62">
              <mat-datepicker-toggle matSuffix [for]="picker10">
                <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
              </mat-datepicker-toggle>
              <mat-datepicker #picker10></mat-datepicker>
            </mat-form-field>
            <br/>
            <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
              <p style="margin-left: 10px; margin-top: 28px">/ </p>
              <mat-form-field appearance="standard" style="margin-left: 10px; width: 130px">
                <mat-label>Within/Before</mat-label>
                <mat-select [(ngModel)]="includedPeriodOperator2" formControlName="control152" (ngModelChange)="formChanged()">
                  <mat-option *ngFor="let value of withinBefore" [value]="value.withinBefore">
                    {{value.withinBefore}}
                  </mat-option>
                </mat-select>
              </mat-form-field>
              <mat-form-field appearance="standard" style="margin-left: 10px; width: 60px">
                <mat-label>Period</mat-label>
                <input matInput placeholder="Value" [(ngModel)]="includedPeriodValue2" formControlName="control63" (keydown.enter)="stepper.next()">
              </mat-form-field>
              <mat-form-field appearance="standard" style="margin-left: 10px; width: 160px">
                <mat-label>Days/Weeks/Months</mat-label>
                <mat-select [(ngModel)]="includedPeriodType2" formControlName="control64" (ngModelChange)="formChanged()">
                  <mat-option *ngFor="let value of period" [value]="value.period">
                    {{value.period}}
                  </mat-option>
                </mat-select>
              </mat-form-field><p style="margin-left: 10px; margin-top: 28px"> of the run date</p>
            </div>
          </div>

          <div mat-dialog-actions style="margin-bottom: 10px; margin-left: 20px" *ngIf="addQuery2">
            <button mat-flat-button color="accent" (click)="addSameRule2()">Add same rule</button>
          </div>
        </div>

        <br/>
        <mat-divider></mat-divider>
        <br/>

        <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start" *ngIf="select2a">
          <mat-form-field appearance="standard" style="margin-left: 10px; width: 125px">
            <mat-label>Include/Exclude</mat-label>
            <mat-select [(ngModel)]="includedExclude2a" formControlName="control26a" (ngModelChange)="formChanged()">
              <mat-option *ngFor="let value of exclude" [value]="value.exclude">
                {{value.exclude}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <br/>
          <p style="margin-left: 10px; margin-top: 29px">patients with records containing <span style="color: blue">concepts</span> matching</p>
          <mat-form-field appearance="standard" style="margin-left: 10px; width: 70px">
            <mat-label>Any/All</mat-label>
            <mat-select [(ngModel)]="includedAnyAll2a" formControlName="control50" (ngModelChange)="formChanged()">
              <mat-option *ngFor="let value of anyAll" [value]="value.anyAll">
                {{value.anyAll}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <p style="margin-left: 10px; margin-top: 28px"> of the <span style="color: blue">value set(s)</span></p>
          <mat-form-field appearance="standard" style="width: 450px; margin-left: 10px">
            <mat-label>Cohort value set</mat-label>
            <mat-select multiple [(ngModel)]="includedValueSet2a" formControlName="control27a" (ngModelChange)="formChanged()">
              <mat-select-search [formControl]="filterCtrl"></mat-select-search>
              <mat-option *ngFor="let result of filteredValueset | async" [value]="result" matTooltipClass="tooltip" matTooltipPosition="right" matTooltip="{{result}}">
                {{result}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <br/>
          <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <p style="margin-left: 10px; margin-top: 28px">and the <span style="color: blue">value</span> of the</p>
            <mat-form-field appearance="standard" style="margin-left: 10px; width: 120px">
              <mat-label>Earliest/Latest</mat-label>
              <mat-select [(ngModel)]="includedEarliestLatest2a" formControlName="control28a" (ngModelChange)="formChanged()">
                <mat-option *ngFor="let value of earliestLatest" [value]="value.earliestLatest">
                  {{value.earliestLatest}}
                </mat-option>
              </mat-select>
            </mat-form-field>
            <p style="margin-left: 10px; margin-top: 28px"><span style="color: blue">entry</span> is</p>
            <mat-form-field appearance="standard" style="margin-left: 10px; width: 110px">
              <mat-label>Less/Greater</mat-label>
              <mat-select [(ngModel)]="includedOperator2a" formControlName="control29a" (ngModelChange)="formChanged()">
                <mat-option *ngFor="let value of operator" [value]="value.operator">
                  {{value.operator}}
                </mat-option>
              </mat-select>
            </mat-form-field>
            <mat-form-field appearance="standard" style="margin-left: 10px; width: 100px">
              <mat-label>Entry value</mat-label>
              <input matInput placeholder="Value" [(ngModel)]="includedEntryValue2a" formControlName="control30a" (keydown.enter)="stepper.next()">
            </mat-form-field>
          </div>
          <br/>
          <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <p style="margin-left: 10px; margin-top: 28px">within the <span style="color: blue">time period</span></p>
            <mat-form-field class="example-full-width" appearance="standard" style="margin-left: 10px; width: 120px">
              <mat-label>Date from</mat-label>
              <input matInput [matDatepicker]="picker9a" placeholder="Date from" [(ngModel)]="includedDateFrom2a" formControlName="control61a">
              <mat-datepicker-toggle matSuffix [for]="picker9a">
                <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
              </mat-datepicker-toggle>
              <mat-datepicker #picker9a></mat-datepicker>
            </mat-form-field>
            <p style="margin-left: 10px; margin-top: 28px">to</p>
            <mat-form-field class="example-full-width" appearance="standard" style="margin-left: 10px; width: 120px">
              <mat-label>Date to</mat-label>
              <input matInput [matDatepicker]="picker10a" placeholder="Date to" [(ngModel)]="includedDateTo2a" formControlName="control62a">
              <mat-datepicker-toggle matSuffix [for]="picker10a">
                <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
              </mat-datepicker-toggle>
              <mat-datepicker #picker10a></mat-datepicker>
            </mat-form-field>
            <br/>
            <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
              <p style="margin-left: 10px; margin-top: 28px">/ </p>
              <mat-form-field appearance="standard" style="margin-left: 10px; width: 130px">
                <mat-label>Within/Before</mat-label>
                <mat-select [(ngModel)]="includedPeriodOperator2a" formControlName="control153" (ngModelChange)="formChanged()">
                  <mat-option *ngFor="let value of withinBefore" [value]="value.withinBefore">
                    {{value.withinBefore}}
                  </mat-option>
                </mat-select>
              </mat-form-field>
              <mat-form-field appearance="standard" style="margin-left: 10px; width: 60px">
                <mat-label>Period</mat-label>
                <input matInput placeholder="Value" [(ngModel)]="includedPeriodValue2a" formControlName="control63a" (keydown.enter)="stepper.next()">
              </mat-form-field>
              <mat-form-field appearance="standard" style="margin-left: 10px; width: 160px">
                <mat-label>Days/Weeks/Months</mat-label>
                <mat-select [(ngModel)]="includedPeriodType2a" formControlName="control64a" (ngModelChange)="formChanged()">
                  <mat-option *ngFor="let value of period" [value]="value.period">
                    {{value.period}}
                  </mat-option>
                </mat-select>
              </mat-form-field><p style="margin-left: 10px; margin-top: 28px"> of the run date</p>
            </div>
          </div>
        </div>

        <br *ngIf="select2a"/>
        <mat-divider *ngIf="select2a"></mat-divider>
        <br *ngIf="select2a"/>

        <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
          <mat-form-field appearance="standard" style="margin-left: 10px; width: 125px">
            <mat-label>Include/Exclude</mat-label>
            <mat-select [(ngModel)]="includedExclude3" formControlName="control31" (ngModelChange)="formChanged()">
              <mat-option *ngFor="let value of exclude" [value]="value.exclude">
                {{value.exclude}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <p style="margin-left: 10px; margin-top: 28px">patients with records containing <span style="color: blue">concepts</span> matching</p>
          <mat-form-field appearance="standard" style="margin-left: 10px; width: 70px">
            <mat-label>Any/All</mat-label>
            <mat-select [(ngModel)]="includedAnyAll3" formControlName="control51" (ngModelChange)="formChanged()">
              <mat-option *ngFor="let value of anyAll" [value]="value.anyAll">
                {{value.anyAll}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <p style="margin-left: 10px; margin-top: 28px"> of the <span style="color: blue">value set(s)</span></p>
          <mat-form-field appearance="standard" style="width: 450px; margin-left: 10px">
            <mat-label>Cohort value set</mat-label>
            <mat-select multiple [(ngModel)]="includedValueSet3" formControlName="control32" (ngModelChange)="formChanged()">
              <mat-select-search [formControl]="filterCtrl"></mat-select-search>
              <mat-option *ngFor="let result of filteredValueset | async" [value]="result" matTooltipClass="tooltip" matTooltipPosition="right" matTooltip="{{result}}">
                {{result}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <br/>
          <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <p style="margin-left: 10px; margin-top: 28px">and the <span style="color: blue">value</span> of the</p>
            <mat-form-field appearance="standard" style="margin-left: 10px; width: 120px">
              <mat-label>Earliest/Latest</mat-label>
              <mat-select [(ngModel)]="includedEarliestLatest3" formControlName="control33" (ngModelChange)="formChanged()">
                <mat-option *ngFor="let value of earliestLatest" [value]="value.earliestLatest">
                  {{value.earliestLatest}}
                </mat-option>
              </mat-select>
            </mat-form-field>
            <p style="margin-left: 10px; margin-top: 28px"><span style="color: blue">entry concept</span> is</p>
            <mat-form-field appearance="standard" style="margin-left: 10px; width: 70px">
              <mat-label>Any/All</mat-label>
              <mat-select [(ngModel)]="includedAnyAllTested3" formControlName="control52" (ngModelChange)="formChanged()">
                <mat-option *ngFor="let value of anyAll" [value]="value.anyAll">
                  {{value.anyAll}}
                </mat-option>
              </mat-select>
            </mat-form-field>
            <p style="margin-left: 10px; margin-top: 28px"> of the <span style="color: blue">value set(s)</span></p>
            <mat-form-field appearance="standard" style="width: 450px; margin-left: 10px">
              <mat-label>Cohort value set</mat-label>
              <mat-select multiple [(ngModel)]="includedTestedValueSet3" formControlName="control34" (ngModelChange)="formChanged()">
                <mat-select-search [formControl]="filterCtrl"></mat-select-search>
                <mat-option *ngFor="let result of filteredValueset | async" [value]="result" matTooltipClass="tooltip" matTooltipPosition="right" matTooltip="{{result}}">
                  {{result}}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <br/>
          <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <p style="margin-left: 10px; margin-top: 28px">within the <span style="color: blue">time period</span></p>
            <mat-form-field class="example-full-width" appearance="standard" style="margin-left: 10px; width: 120px">
              <mat-label>Date from</mat-label>
              <input matInput [matDatepicker]="picker93" placeholder="Date from" [(ngModel)]="includedDateFrom3" formControlName="control65">
              <mat-datepicker-toggle matSuffix [for]="picker93">
                <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
              </mat-datepicker-toggle>
              <mat-datepicker #picker93></mat-datepicker>
            </mat-form-field>
            <p style="margin-left: 10px; margin-top: 28px">to</p>
            <mat-form-field class="example-full-width" appearance="standard" style="margin-left: 10px; width: 120px">
              <mat-label>Date to</mat-label>
              <input matInput [matDatepicker]="picker103" placeholder="Date to" [(ngModel)]="includedDateTo3" formControlName="control66">
              <mat-datepicker-toggle matSuffix [for]="picker103">
                <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
              </mat-datepicker-toggle>
              <mat-datepicker #picker103></mat-datepicker>
            </mat-form-field>
            <br/>
            <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
              <p style="margin-left: 10px; margin-top: 28px">/ </p>
              <mat-form-field appearance="standard" style="margin-left: 10px; width: 130px">
                <mat-label>Within/Before</mat-label>
                <mat-select [(ngModel)]="includedPeriodOperator3" formControlName="control69" (ngModelChange)="formChanged()">
                  <mat-option *ngFor="let value of withinBefore" [value]="value.withinBefore">
                    {{value.withinBefore}}
                  </mat-option>
                </mat-select>
              </mat-form-field>
              <mat-form-field appearance="standard" style="margin-left: 10px; width: 60px">
                <mat-label>Period</mat-label>
                <input matInput placeholder="Value" [(ngModel)]="includedPeriodValue3" formControlName="control67" (keydown.enter)="stepper.next()">
              </mat-form-field>
              <mat-form-field appearance="standard" style="margin-left: 10px; width: 160px">
                <mat-label>Days/Weeks/Months</mat-label>
                <mat-select [(ngModel)]="includedPeriodType3" formControlName="control68" (ngModelChange)="formChanged()">
                  <mat-option *ngFor="let value of period" [value]="value.period">
                    {{value.period}}
                  </mat-option>
                </mat-select>
              </mat-form-field><p style="margin-left: 10px; margin-top: 28px"> of the run date</p>
            </div>
            <div mat-dialog-actions style="margin-bottom: 10px; margin-left: 20px" *ngIf="addQuery3">
              <button mat-flat-button color="accent" (click)="addSameRule3()">Add same rule</button>
            </div>
          </div>
        </div>

        <br/>
        <mat-divider></mat-divider>
        <br/>

        <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start" *ngIf="select3a">
          <mat-form-field appearance="standard" style="margin-left: 10px; width: 125px">
            <mat-label>Include/Exclude</mat-label>
            <mat-select [(ngModel)]="includedExclude3a" formControlName="control31a" (ngModelChange)="formChanged()">
              <mat-option *ngFor="let value of exclude" [value]="value.exclude">
                {{value.exclude}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <p style="margin-left: 10px; margin-top: 28px">patients with records containing <span style="color: blue">concepts</span> matching</p>
          <mat-form-field appearance="standard" style="margin-left: 10px; width: 70px">
            <mat-label>Any/All</mat-label>
            <mat-select [(ngModel)]="includedAnyAll3a" formControlName="control51a" (ngModelChange)="formChanged()">
              <mat-option *ngFor="let value of anyAll" [value]="value.anyAll">
                {{value.anyAll}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <p style="margin-left: 10px; margin-top: 28px"> of the <span style="color: blue">value set(s)</span></p>
          <mat-form-field appearance="standard" style="width: 450px; margin-left: 10px">
            <mat-label>Cohort value set</mat-label>
            <mat-select multiple [(ngModel)]="includedValueSet3a" formControlName="control32a" (ngModelChange)="formChanged()">
              <mat-select-search [formControl]="filterCtrl"></mat-select-search>
              <mat-option *ngFor="let result of filteredValueset | async" [value]="result" matTooltipClass="tooltip" matTooltipPosition="right" matTooltip="{{result}}">
                {{result}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <br/>
          <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <p style="margin-left: 10px; margin-top: 28px">and the <span style="color: blue">value</span> of the</p>
            <mat-form-field appearance="standard" style="margin-left: 10px; width: 120px">
              <mat-label>Earliest/Latest</mat-label>
              <mat-select [(ngModel)]="includedEarliestLatest3a" formControlName="control33a" (ngModelChange)="formChanged()">
                <mat-option *ngFor="let value of earliestLatest" [value]="value.earliestLatest">
                  {{value.earliestLatest}}
                </mat-option>
              </mat-select>
            </mat-form-field>
            <p style="margin-left: 10px; margin-top: 28px"><span style="color: blue">entry concept</span> is</p>
            <mat-form-field appearance="standard" style="margin-left: 10px; width: 70px">
              <mat-label>Any/All</mat-label>
              <mat-select [(ngModel)]="includedAnyAllTested3a" formControlName="control52a" (ngModelChange)="formChanged()">
                <mat-option *ngFor="let value of anyAll" [value]="value.anyAll">
                  {{value.anyAll}}
                </mat-option>
              </mat-select>
            </mat-form-field>
            <p style="margin-left: 10px; margin-top: 28px"> of the <span style="color: blue">value set(s)</span></p>
            <mat-form-field appearance="standard" style="width: 450px; margin-left: 10px">
              <mat-label>Cohort value set</mat-label>
              <mat-select multiple [(ngModel)]="includedTestedValueSet3a" formControlName="control34a" (ngModelChange)="formChanged()">
                <mat-select-search [formControl]="filterCtrl"></mat-select-search>
                <mat-option *ngFor="let result of filteredValueset | async" [value]="result" matTooltipClass="tooltip" matTooltipPosition="right" matTooltip="{{result}}">
                  {{result}}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <br/>
          <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <p style="margin-left: 10px; margin-top: 28px">within the <span style="color: blue">time period</span></p>
            <mat-form-field class="example-full-width" appearance="standard" style="margin-left: 10px; width: 120px">
              <mat-label>Date from</mat-label>
              <input matInput [matDatepicker]="picker93a" placeholder="Date from" [(ngModel)]="includedDateFrom3a" formControlName="control65a">
              <mat-datepicker-toggle matSuffix [for]="picker93a">
                <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
              </mat-datepicker-toggle>
              <mat-datepicker #picker93a></mat-datepicker>
            </mat-form-field>
            <p style="margin-left: 10px; margin-top: 28px">to</p>
            <mat-form-field class="example-full-width" appearance="standard" style="margin-left: 10px; width: 120px">
              <mat-label>Date to</mat-label>
              <input matInput [matDatepicker]="picker103a" placeholder="Date to" [(ngModel)]="includedDateTo3a" formControlName="control66a">
              <mat-datepicker-toggle matSuffix [for]="picker103a">
                <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
              </mat-datepicker-toggle>
              <mat-datepicker #picker103a></mat-datepicker>
            </mat-form-field>
            <br/>
            <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
              <p style="margin-left: 10px; margin-top: 28px">/ </p>
              <mat-form-field appearance="standard" style="margin-left: 10px; width: 130px">
                <mat-label>Within/Before</mat-label>
                <mat-select [(ngModel)]="includedPeriodOperator3a" formControlName="control69a" (ngModelChange)="formChanged()">
                  <mat-option *ngFor="let value of withinBefore" [value]="value.withinBefore">
                    {{value.withinBefore}}
                  </mat-option>
                </mat-select>
              </mat-form-field>

              <mat-form-field appearance="standard" style="margin-left: 10px; width: 60px">
                <mat-label>Period</mat-label>
                <input matInput placeholder="Value" [(ngModel)]="includedPeriodValue3a" formControlName="control67a" (keydown.enter)="stepper.next()">
              </mat-form-field>
              <mat-form-field appearance="standard" style="margin-left: 10px; width: 160px">
                <mat-label>Days/Weeks/Months</mat-label>
                <mat-select [(ngModel)]="includedPeriodType3a" formControlName="control68a" (ngModelChange)="formChanged()">
                  <mat-option *ngFor="let value of period" [value]="value.period">
                    {{value.period}}
                  </mat-option>
                </mat-select>
              </mat-form-field><p style="margin-left: 10px; margin-top: 28px"> of the run date</p>
            </div>
          </div>
        </div>

        <br *ngIf="select3a"/>
        <mat-divider *ngIf="select3a"></mat-divider>
        <br *ngIf="select3a"/>

        <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
          <mat-form-field appearance="standard" style="margin-left: 10px; width: 125px">
            <mat-label>Include/Exclude</mat-label>
            <mat-select [(ngModel)]="includedExclude4" formControlName="control35" (ngModelChange)="formChanged()">
              <mat-option *ngFor="let value of exclude" [value]="value.exclude">
                {{value.exclude}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <p style="margin-left: 10px; margin-top: 28px">patients with records containing <span style="color: blue">concepts</span> matching</p>
          <mat-form-field appearance="standard" style="margin-left: 10px; width: 70px">
            <mat-label>Any/All</mat-label>
            <mat-select [(ngModel)]="includedAnyAll4" formControlName="control53" (ngModelChange)="formChanged()">
              <mat-option *ngFor="let value of anyAll" [value]="value.anyAll">
                {{value.anyAll}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <p style="margin-left: 10px; margin-top: 28px">of the <span style="color: blue">value set(s)</span></p>
          <mat-form-field appearance="standard" style="width: 450px; margin-left: 10px">
            <mat-label>Cohort value set</mat-label>
            <mat-select multiple [(ngModel)]="includedValueSet4" formControlName="control36" (ngModelChange)="formChanged()">
              <mat-select-search [formControl]="filterCtrl"></mat-select-search>
              <mat-option *ngFor="let result of filteredValueset | async" [value]="result" matTooltipClass="tooltip" matTooltipPosition="right" matTooltip="{{result}}">
                {{result}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <p style="margin-left: 10px; margin-top: 28px; display: inline">and those <span style="color: blue">entries</span></p>
          <mat-form-field appearance="standard" style="width: 100px; margin-left: 10px">
            <mat-label>Are/Are not</mat-label>
            <mat-select [(ngModel)]="includedAreNot4 " formControlName="control54" (ngModelChange)="formChanged()">
              <mat-option *ngFor="let value of areNot" [value]="value.areNot">
                {{value.areNot}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <p style="margin-left: 10px; margin-top: 28px; display: inline"><span style="color: blue">followed</span> by <span style="color: blue">entries</span> containing <span style="color: blue">concepts</span> matching </p>
          <mat-form-field appearance="standard" style="margin-left: 10px; width: 70px">
            <mat-label>Any/All</mat-label>
            <mat-select [(ngModel)]="includedAnyAllFollowedBy4" formControlName="control55" (ngModelChange)="formChanged()">
              <mat-option *ngFor="let value of anyAll" [value]="value.anyAll">
                {{value.anyAll}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <p style="margin-left: 10px; margin-top: 28px">of the <span style="color: blue">value set(s)</span></p>
          <mat-form-field appearance="standard" style="width: 450px; margin-left: 10px">
            <mat-label>Cohort value set</mat-label>
            <mat-select multiple [(ngModel)]="includedFollowedByValueSet4" formControlName="control37" (ngModelChange)="formChanged()">
              <mat-select-search [formControl]="filterCtrl"></mat-select-search>
              <mat-option *ngFor="let result of filteredValueset | async" [value]="result" matTooltipClass="tooltip" matTooltipPosition="right" matTooltip="{{result}}">
                {{result}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <br/>
          <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
              <mat-form-field appearance="standard" style="margin-left: 10px; width: 130px">
                <mat-label>Within/Before</mat-label>
                <mat-select [(ngModel)]="includedPeriodOperator4" formControlName="control154" (ngModelChange)="formChanged()">
                  <mat-option *ngFor="let value of withinBefore" [value]="value.withinBefore">
                    {{value.withinBefore}}
                  </mat-option>
                </mat-select>
              </mat-form-field>
              <mat-form-field appearance="standard" style="margin-left: 10px; width: 60px">
                <mat-label>Period</mat-label>
                <input matInput placeholder="Value" [(ngModel)]="includedPeriodValue4" formControlName="control38" (keydown.enter)="stepper.next()">
              </mat-form-field>
              <mat-form-field appearance="standard" style="margin-left: 10px; width: 160px">
                <mat-label>Days/Weeks/Months</mat-label>
                <mat-select [(ngModel)]="includedPeriodType4" formControlName="control39" (ngModelChange)="formChanged()">
                  <mat-option *ngFor="let value of period" [value]="value.period">
                    {{value.period}}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
          </div>
        </div>

        <br/>
        <mat-divider></mat-divider>
        <br/>

        <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
          <mat-form-field appearance="standard" style="margin-left: 10px; width: 125px">
            <mat-label>Include/Exclude</mat-label>
            <mat-select [(ngModel)]="includedExclude5" formControlName="control40" (ngModelChange)="formChanged()">
              <mat-option *ngFor="let value of exclude" [value]="value.exclude">
                {{value.exclude}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <p style="margin-left: 10px; margin-top: 28px">patients with records containing <span style="color: blue">concepts</span> matching</p>
          <mat-form-field appearance="standard" style="margin-left: 10px; width: 70px">
            <mat-label>Any/All</mat-label>
            <mat-select [(ngModel)]="includedAnyAll5" formControlName="control56" (ngModelChange)="formChanged()">
              <mat-option *ngFor="let value of anyAll" [value]="value.anyAll">
                {{value.anyAll}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <p style="margin-left: 10px; margin-top: 28px">of the <span style="color: blue">value set(s)</span></p>
          <mat-form-field appearance="standard" style="width: 450px; margin-left: 10px">
            <mat-label>Cohort value set</mat-label>
            <mat-select multiple [(ngModel)]="includedValueSet5" formControlName="control41" (ngModelChange)="formChanged()">
              <mat-select-search [formControl]="filterCtrl"></mat-select-search>
              <mat-option *ngFor="let result of filteredValueset | async" [value]="result" matTooltipClass="tooltip" matTooltipPosition="right" matTooltip="{{result}}">
                {{result}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <br/>
          <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <p style="margin-left: 10px; margin-top: 28px">and there are</p>
            <mat-form-field appearance="standard" style="margin-left: 10px; width: 110px">
              <mat-label>Less/Greater</mat-label>
              <mat-select [(ngModel)]="includedOperator5" formControlName="control42" (ngModelChange)="formChanged()">
                <mat-option *ngFor="let value of operator" [value]="value.operator">
                  {{value.operator}}
                </mat-option>
              </mat-select>
            </mat-form-field>
            <mat-form-field appearance="standard" style="margin-left: 10px; width: 60px">
              <mat-label>Value</mat-label>
              <input matInput placeholder="Value" [(ngModel)]="includedEntryValue5" formControlName="control43" (keydown.enter)="stepper.next()">
            </mat-form-field>
            <p style="margin-left: 10px; margin-top: 28px"><span style="color: blue">occurrences</span> of these <span style="color: blue">concepts</span>
            <br/>
            <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
              <p style="margin-left: 10px; margin-top: 28px">within the <span style="color: blue">time period</span></p>
              <mat-form-field class="example-full-width" appearance="standard" style="margin-left: 10px; width: 120px">
                <mat-label>Date from</mat-label>
                <input matInput [matDatepicker]="picker7" placeholder="Date from" [(ngModel)]="includedDateFrom5" formControlName="control44">
                <mat-datepicker-toggle matSuffix [for]="picker7">
                  <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
                </mat-datepicker-toggle>
                <mat-datepicker #picker7></mat-datepicker>
              </mat-form-field>
              <p style="margin-left: 10px; margin-top: 28px">to</p>
              <mat-form-field class="example-full-width" appearance="standard" style="margin-left: 10px; width: 120px">
                <mat-label>Date to</mat-label>
                <input matInput [matDatepicker]="picker8" placeholder="Date to" [(ngModel)]="includedDateTo5" formControlName="control45">
                <mat-datepicker-toggle matSuffix [for]="picker8">
                  <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
                </mat-datepicker-toggle>
                <mat-datepicker #picker8></mat-datepicker>
              </mat-form-field>
              <br/>
              <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
                <p style="margin-left: 10px; margin-top: 28px">/ </p>
                <mat-form-field appearance="standard" style="margin-left: 10px; width: 130px">
                  <mat-label>Within/Before</mat-label>
                  <mat-select [(ngModel)]="includedPeriodOperator5" formControlName="control155" (ngModelChange)="formChanged()">
                    <mat-option *ngFor="let value of withinBefore" [value]="value.withinBefore">
                      {{value.withinBefore}}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
                <mat-form-field appearance="standard" style="margin-left: 10px; width: 60px">
                  <mat-label>Period</mat-label>
                  <input matInput placeholder="Value" [(ngModel)]="includedPeriodValue5" formControlName="control57" (keydown.enter)="stepper.next()">
                </mat-form-field>
                <mat-form-field appearance="standard" style="margin-left: 10px; width: 160px">
                  <mat-label>Days/Weeks/Months</mat-label>
                  <mat-select [(ngModel)]="includedPeriodType5" formControlName="control58" (ngModelChange)="formChanged()">
                    <mat-option *ngFor="let value of period" [value]="value.period">
                      {{value.period}}
                    </mat-option>
                  </mat-select>
                </mat-form-field><p style="margin-left: 10px; margin-top: 28px"> of the run date</p>
              </div>
            </div>
            <div mat-dialog-actions style="margin-bottom: 10px; margin-left: 20px" *ngIf="addQuery5">
              <button mat-flat-button color="accent" (click)="addSameRule5()">Add same rule</button>
            </div>
          </div>
        </div>

        <br/>
        <mat-divider></mat-divider>
        <br/>

        <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start" *ngIf="select5a">
          <mat-form-field appearance="standard" style="margin-left: 10px; width: 125px">
            <mat-label>Include/Exclude</mat-label>
            <mat-select [(ngModel)]="includedExclude5a" formControlName="control40a" (ngModelChange)="formChanged()">
              <mat-option *ngFor="let value of exclude" [value]="value.exclude">
                {{value.exclude}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <p style="margin-left: 10px; margin-top: 28px">patients with records containing <span style="color: blue">concepts</span> matching</p>
          <mat-form-field appearance="standard" style="margin-left: 10px; width: 70px">
            <mat-label>Any/All</mat-label>
            <mat-select [(ngModel)]="includedAnyAll5a" formControlName="control56a" (ngModelChange)="formChanged()">
              <mat-option *ngFor="let value of anyAll" [value]="value.anyAll">
                {{value.anyAll}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <p style="margin-left: 10px; margin-top: 28px">of the <span style="color: blue">value set(s)</span></p>
          <mat-form-field appearance="standard" style="width: 450px; margin-left: 10px">
            <mat-label>Cohort value set</mat-label>
            <mat-select multiple [(ngModel)]="includedValueSet5a" formControlName="control41a" (ngModelChange)="formChanged()">
              <mat-select-search [formControl]="filterCtrl"></mat-select-search>
              <mat-option *ngFor="let result of filteredValueset | async" [value]="result" matTooltipClass="tooltip" matTooltipPosition="right" matTooltip="{{result}}">
                {{result}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <br/>
          <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <p style="margin-left: 10px; margin-top: 28px">and there are</p>
            <mat-form-field appearance="standard" style="margin-left: 10px; width: 110px">
              <mat-label>Less/Greater</mat-label>
              <mat-select [(ngModel)]="includedOperator5a" formControlName="control42a" (ngModelChange)="formChanged()">
                <mat-option *ngFor="let value of operator" [value]="value.operator">
                  {{value.operator}}
                </mat-option>
              </mat-select>
            </mat-form-field>
            <mat-form-field appearance="standard" style="margin-left: 10px; width: 60px">
              <mat-label>Value</mat-label>
              <input matInput placeholder="Value" [(ngModel)]="includedEntryValue5a" formControlName="control43a" (keydown.enter)="stepper.next()">
            </mat-form-field>
            <p style="margin-left: 10px; margin-top: 28px"><span style="color: blue">occurrences</span> of these <span style="color: blue">concepts</span>
            <br/>
            <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
              <p style="margin-left: 10px; margin-top: 28px">within the <span style="color: blue">time period</span></p>
              <mat-form-field class="example-full-width" appearance="standard" style="margin-left: 10px; width: 120px">
                <mat-label>Date from</mat-label>
                <input matInput [matDatepicker]="picker7a" placeholder="Date from" [(ngModel)]="includedDateFrom5a" formControlName="control44a">
                <mat-datepicker-toggle matSuffix [for]="picker7a">
                  <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
                </mat-datepicker-toggle>
                <mat-datepicker #picker7a></mat-datepicker>
              </mat-form-field>
              <p style="margin-left: 10px; margin-top: 28px">to</p>
              <mat-form-field class="example-full-width" appearance="standard" style="margin-left: 10px; width: 120px">
                <mat-label>Date to</mat-label>
                <input matInput [matDatepicker]="picker8a" placeholder="Date to" [(ngModel)]="includedDateTo5a" formControlName="control45a">
                <mat-datepicker-toggle matSuffix [for]="picker8a">
                  <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
                </mat-datepicker-toggle>
                <mat-datepicker #picker8a></mat-datepicker>
              </mat-form-field>
              <br/>
              <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
                <p style="margin-left: 10px; margin-top: 28px">/ </p>
                <mat-form-field appearance="standard" style="margin-left: 10px; width: 130px">
                  <mat-label>Within/Before</mat-label>
                  <mat-select [(ngModel)]="includedPeriodOperator5a" formControlName="control156" (ngModelChange)="formChanged()">
                    <mat-option *ngFor="let value of withinBefore" [value]="value.withinBefore">
                      {{value.withinBefore}}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
                <mat-form-field appearance="standard" style="margin-left: 10px; width: 60px">
                  <mat-label>Period</mat-label>
                  <input matInput placeholder="Value" [(ngModel)]="includedPeriodValue5a" formControlName="control57a" (keydown.enter)="stepper.next()">
                </mat-form-field>
                <mat-form-field appearance="standard" style="margin-left: 10px; width: 160px">
                  <mat-label>Days/Weeks/Months</mat-label>
                  <mat-select [(ngModel)]="includedPeriodType5a" formControlName="control58a" (ngModelChange)="formChanged()">
                    <mat-option *ngFor="let value of period" [value]="value.period">
                      {{value.period}}
                    </mat-option>
                  </mat-select>
                </mat-form-field><p style="margin-left: 10px; margin-top: 28px"> of the run date</p>
              </div>
            </div>
          </div>
        </div>

        <br *ngIf="select5a"/>
        <mat-divider *ngIf="select5a"></mat-divider>
        <br *ngIf="select5a"/>

        </div>

        <div style="margin-top: 30px" mat-dialog-actions align="end">
          <button style="margin-right: 15px" mat-button color="accent" (click)="onCancelClick()">Cancel</button>
          <button style="margin-right: 15px" mat-button color="accent" matStepperPrevious>Back</button>
          <button style="margin-right: 15px" mat-flat-button color="accent" (click)="stepper.next()">Next</button>
          <button style="margin-right: 15px" mat-flat-button color="accent" [disabled]="disableForm" (click)="saveQuery()">Save</button>
        </div>
      </form>
    </mat-step>

    <mat-step [stepControl]="fourthFormGroup" errorMessage="Step not completed.">
      <form [formGroup]="fourthFormGroup">
        <ng-template matStepLabel>Data set criteria</ng-template>
        <p>Once a patient cohort has been identified, these are the choices for defining the data set (output tables).
        The data set output tables will be produced for each patient identified in the cohort.
        The data set can be delivered as either CSV files to a secure location, or as tables in the dashboards.
        </p>
        <br/>
        <table>
          <tr class="table-header">
            <td style="width: 100px">Select tables to output</td>
            <td>Date range</td>
            <td>Table fields</td>
            <td>Filter by types</td>
            <td>Filter by value set</td>
          </tr>
          <tr>
            <td>
              <mat-checkbox class="checkbox" [(ngModel)]="demographics" formControlName="control165a">Demographics</mat-checkbox>
            </td>
            <td >
            </td>
            <td >
              <mat-form-field appearance="outline" style="width: 200px">
                <mat-label>Demographic fields</mat-label>
                <mat-select multiple [(ngModel)]="selectedDemographicFields" formControlName="control165e" (ngModelChange)="formChanged()">
                  <mat-option *ngFor="let field of demographicsFieldList" [value]="field">
                    {{field}}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td>
              <mat-checkbox class="checkbox" [(ngModel)]="encounters" formControlName="control166a">Encounters</mat-checkbox>
            </td>
            <td >
              <mat-form-field class="example-full-width" appearance="outline" style="width: 130px">
                <mat-label>Date from</mat-label>
                <input matInput [matDatepicker]="picker66c" placeholder="Date from" [(ngModel)]="dateFromEncounters" formControlName="control166c">
                <mat-datepicker-toggle matSuffix [for]="picker66c">
                  <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
                </mat-datepicker-toggle>
                <mat-datepicker #picker66c></mat-datepicker>
              </mat-form-field>

              <mat-form-field class="example-full-width" appearance="outline" style="width: 130px; margin-left: 10px">
                <mat-label>Date to</mat-label>
                <input matInput [matDatepicker]="control166d" placeholder="Date to" [(ngModel)]="dateToEncounters" formControlName="control166d">
                <mat-datepicker-toggle matSuffix [for]="control166d">
                  <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
                </mat-datepicker-toggle>
                <mat-datepicker #control166d></mat-datepicker>
              </mat-form-field>
            </td>
            <td >
              <mat-form-field appearance="outline" style="width: 200px">
                <mat-label>Encounter fields</mat-label>
                <mat-select multiple [(ngModel)]="selectedEncounterFields" formControlName="control166e" (ngModelChange)="formChanged()">
                  <mat-option *ngFor="let field of encounterFieldList" [value]="field">
                    {{field}}
                  </mat-option>
                </mat-select>
              </mat-form-field>

            </td>
            <td></td>
            <td >
              <mat-form-field appearance="outline" style="width: 200px">
                <mat-label>Encounter value set</mat-label>
                <mat-select multiple [(ngModel)]="selectedEncounterValueSet" formControlName="control166g" (ngModelChange)="formChanged()">
                  <mat-select-search [formControl]="filterCtrlEncounter"></mat-select-search>
                  <mat-option *ngFor="let result of filteredValuesetEncounter | async" [value]="result" matTooltipClass="tooltip" matTooltipPosition="right" matTooltip="{{result}}">
                    {{result}}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </td>
          </tr>
          <tr>
            <td>
              <mat-checkbox class="checkbox" [(ngModel)]="medication" formControlName="control167a">Medication</mat-checkbox>
              <mat-checkbox class="checkbox" [(ngModel)]="currentMedication" formControlName="control167b">(Current medication only)</mat-checkbox>
            </td>
            <td >
              <mat-form-field class="example-full-width" appearance="outline" style="width: 130px">
                <mat-label>Date from</mat-label>
                <input matInput [matDatepicker]="picker67c" placeholder="Date from" [(ngModel)]="dateFromMedication" formControlName="control167c">
                <mat-datepicker-toggle matSuffix [for]="picker67c">
                  <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
                </mat-datepicker-toggle>
                <mat-datepicker #picker67c></mat-datepicker>
              </mat-form-field>

              <mat-form-field class="example-full-width" appearance="outline" style="width: 130px; margin-left: 10px">
                <mat-label>Date to</mat-label>
                <input matInput [matDatepicker]="control167d" placeholder="Date to" [(ngModel)]="dateToMedication" formControlName="control167d">
                <mat-datepicker-toggle matSuffix [for]="control167d">
                  <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
                </mat-datepicker-toggle>
                <mat-datepicker #control167d></mat-datepicker>
              </mat-form-field>
            </td>
            <td >
              <mat-form-field appearance="outline" style="width: 200px">
                <mat-label>Medication fields</mat-label>
                <mat-select multiple [(ngModel)]="selectedMedicationFields" formControlName="control167e" (ngModelChange)="formChanged()">
                  <mat-option *ngFor="let field of medicationFieldList" [value]="field">
                    {{field}}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </td>
            <td></td>
            <td >
              <mat-form-field appearance="outline" style="width: 200px">
                <mat-label>Medication value set</mat-label>
                <mat-select multiple [(ngModel)]="selectedMedicationValueSet" formControlName="control167g" (ngModelChange)="formChanged()">
                  <mat-select-search [formControl]="filterCtrlMedication"></mat-select-search>
                  <mat-option *ngFor="let result of filteredValuesetMedication | async" [value]="result" matTooltipClass="tooltip" matTooltipPosition="right" matTooltip="{{result}}">
                    {{result}}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </td>
          </tr>
          <tr>
            <td>
              <mat-checkbox class="checkbox" [(ngModel)]="clinicalEvents" formControlName="control168a">Clinical events</mat-checkbox>
              <mat-checkbox class="checkbox" [(ngModel)]="activeProblems" formControlName="control168b">(Active problems only)</mat-checkbox>
            </td>
            <td >
              <mat-form-field class="example-full-width" appearance="outline" style="width: 130px">
                <mat-label>Date from</mat-label>
                <input matInput [matDatepicker]="picker68c" placeholder="Date from" [(ngModel)]="dateFromClinicalEvents" formControlName="control168c">
                <mat-datepicker-toggle matSuffix [for]="picker68c">
                  <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
                </mat-datepicker-toggle>
                <mat-datepicker #picker68c></mat-datepicker>
              </mat-form-field>

              <mat-form-field class="example-full-width" appearance="outline" style="width: 130px; margin-left: 10px">
                <mat-label>Date to</mat-label>
                <input matInput [matDatepicker]="control168d" placeholder="Date to" [(ngModel)]="dateToClinicalEvents" formControlName="control168d">
                <mat-datepicker-toggle matSuffix [for]="control168d">
                  <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
                </mat-datepicker-toggle>
                <mat-datepicker #control168d></mat-datepicker>
              </mat-form-field>
            </td>
            <td >
              <mat-form-field appearance="outline" style="width: 200px">
                <mat-label>Clinical event fields</mat-label>
                <mat-select multiple [(ngModel)]="selectedClinicalEventFields" formControlName="control168e" (ngModelChange)="formChanged()">
                  <mat-option *ngFor="let field of clinicalEventFieldList" [value]="field">
                    {{field}}
                  </mat-option>
                </mat-select>
              </mat-form-field>

            </td>
            <td >
              <mat-form-field appearance="outline" style="width: 200px">
                <mat-label>Clinical types</mat-label>
                <mat-select multiple [(ngModel)]="selectedClinicalTypes" formControlName="control168f" (ngModelChange)="formChanged()">
                  <mat-option *ngFor="let field of clinicalTypeList" [value]="field.clinicalType">
                    {{field.clinicalType}}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </td>
            <td >
              <mat-form-field appearance="outline" style="width: 200px">
                <mat-label>Clinical event value set</mat-label>
                <mat-select multiple [(ngModel)]="selectedClinicalEventValueSet" formControlName="control168g" (ngModelChange)="formChanged()">
                  <mat-select-search [formControl]="filterCtrlObservation"></mat-select-search>
                  <mat-option *ngFor="let result of filteredValuesetObservation | async" [value]="result" matTooltipClass="tooltip" matTooltipPosition="right" matTooltip="{{result}}">
                    {{result}}
                  </mat-option>
                </mat-select>
              </mat-form-field>

            </td>
          </tr>
        </table>

        <div>
          In addition, or instead of output tables with rows as defined above, you can select to aggregate the data over time.
          <br/>
          <br/>
          <mat-checkbox class="checkbox" [(ngModel)]="timeSeries" formControlName="control70"><b>Tick this box to output the data as a time series for inclusion in the dashboard line charts.</b></mat-checkbox>
          <br/>
          <br/>
          Selecting this option will group the patients defined in this cohort by their registering organisation and count the number of individual patients identified each day over the time period specified.
          The X-Axis will be the date of the event, and the Y-Axis will be the count of patients with events matching the selected value set on each date.
          <br/>
          <br/>
          The data source for the events will be
          <mat-form-field appearance="standard" style="margin-left: 10px; width: 110px">
            <mat-label>Table</mat-label>
            <mat-select [(ngModel)]="seriesTable" formControlName="control71" (ngModelChange)="formChanged()">
              <mat-option *ngFor="let value of tables" [value]="value.table">
                {{value.table}}
              </mat-option>
            </mat-select>
          </mat-form-field>
           and the concept(s) to display as chart trend line(s) are from these selected value sets
          <mat-form-field appearance="standard" style="margin-left: 10px; width: 250px" *ngIf="seriesTableEncounter">
            <mat-label>Encounter value set</mat-label>
            <mat-select multiple [(ngModel)]="seriesEncounterValueSet" formControlName="control73" (ngModelChange)="formChanged()">
              <mat-select-search [formControl]="filterCtrlEncounter"></mat-select-search>
              <mat-option *ngFor="let result of filteredValuesetEncounter | async" [value]="result" matTooltipClass="tooltip" matTooltipPosition="right" matTooltip="{{result}}">
                {{result}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field appearance="standard" style="margin-left: 10px; width: 250px" *ngIf="seriesTableMedication">
            <mat-label>Medication value set</mat-label>
            <mat-select multiple [(ngModel)]="seriesMedicationValueSet" formControlName="control74" (ngModelChange)="formChanged()">
              <mat-select-search [formControl]="filterCtrlMedication"></mat-select-search>
              <mat-option *ngFor="let result of filteredValuesetMedication | async" [value]="result" matTooltipClass="tooltip" matTooltipPosition="right" matTooltip="{{result}}">
                {{result}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field appearance="standard" style="margin-left: 10px; width: 250px" *ngIf="seriesTableObservation">
            <mat-label>Cinical events value set</mat-label>
            <mat-select multiple [(ngModel)]="seriesClinicalEventValueSet" formControlName="control75" (ngModelChange)="formChanged()">
              <mat-select-search [formControl]="filterCtrlObservation"></mat-select-search>
              <mat-option *ngFor="let result of filteredValuesetObservation | async" [value]="result" matTooltipClass="tooltip" matTooltipPosition="right" matTooltip="{{result}}">
                {{result}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <br/>
          within the time period
          <mat-form-field appearance="standard" style="margin-left: 10px; width: 120px">
            <mat-label>Date from</mat-label>
            <input matInput [matDatepicker]="picker69c" placeholder="Date from" [(ngModel)]="seriesDateFrom" formControlName="control76">
            <mat-datepicker-toggle matSuffix [for]="picker69c">
              <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
            </mat-datepicker-toggle>
            <mat-datepicker #picker69c></mat-datepicker>
          </mat-form-field>
          to
          <mat-form-field appearance="standard" style="margin-left: 10px; width: 120px">
            <mat-label>Date to</mat-label>
            <input matInput [matDatepicker]="picker169c" placeholder="Date to" [(ngModel)]="seriesDateTo" formControlName="control77">
            <mat-datepicker-toggle matSuffix [for]="picker169c">
              <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
            </mat-datepicker-toggle>
            <mat-datepicker #picker169c></mat-datepicker>
          </mat-form-field>
          /
          <mat-form-field appearance="standard" style="margin-left: 10px; width: 130px">
            <mat-label>Within/Before</mat-label>
            <mat-select [(ngModel)]="seriesPeriodOperator" formControlName="control78" (ngModelChange)="formChanged()">
              <mat-option *ngFor="let value of withinBefore" [value]="value.withinBefore">
                {{value.withinBefore}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field appearance="standard" style="margin-left: 10px; width: 60px">
            <mat-label>Period</mat-label>
            <input matInput placeholder="Value" [(ngModel)]="seriesPeriodValue" formControlName="control79">
          </mat-form-field>
          <mat-form-field appearance="standard" style="margin-left: 10px; width: 160px">
            <mat-label>Days/Weeks/Months</mat-label>
            <mat-select [(ngModel)]="seriesPeriodType" formControlName="control80" (ngModelChange)="formChanged()">
              <mat-option *ngFor="let value of period" [value]="value.period">
                {{value.period}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          of the run date.
        </div>

        <div style="margin-top: 0px" mat-dialog-actions align="end">
          <button style="margin-right: 15px" mat-button color="accent" (click)="onCancelClick()">Cancel</button>
          <button style="margin-right: 15px" mat-button color="accent" matStepperPrevious>Back</button>
          <button style="margin-right: 15px" mat-flat-button color="accent" (click)="stepper.next()">Next</button>
          <button style="margin-right: 15px" mat-flat-button color="accent" [disabled]="disableForm" (click)="saveQuery()">Save</button>
        </div>
      </form>
    </mat-step>

    <mat-step [stepControl]="fifthFormGroup" errorMessage="Step not completed.">
      <form [formGroup]="fifthFormGroup">
        <ng-template matStepLabel>Data set output definition</ng-template>
        <br/>

        <div class="summary-column">
          <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <mat-form-field appearance="outline" style="margin-left: 25px">
              <mat-label>Refresh schedule</mat-label>
              <mat-select [(ngModel)]="selectedSchedule" formControlName="control18" (ngModelChange)="formChanged()" required>
                <mat-option *ngFor="let schedule of schedules" [value]="schedule.scheduleValue">
                  {{schedule.scheduleValue}}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <br/>
          <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <mat-form-field appearance="outline" style="margin-left: 25px">
              <mat-label>Delivery mechanism</mat-label>
              <mat-select [(ngModel)]="selectedDelivery" formControlName="control19" (ngModelChange)="formChanged()" required>
                <mat-option *ngFor="let delivery of deliveries" [value]="delivery.deliveryValue">
                  {{delivery.deliveryValue}}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <br/>
          <span style="margin-left: 30px">*Required</span>
        </div>

        <div class="summary-column">
          <div style="margin-top: 7px" class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <p>How often should this data set be refreshed.</p>
          </div>
          <div style="margin-top: 30px" class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <p>The mechanism that is used to deliver the report.</p>
          </div>
        </div>

        <div style="margin-top: 530px" mat-dialog-actions align="end">
          <button style="margin-right: 15px" mat-button color="accent" (click)="onCancelClick()">Cancel</button>
          <button style="margin-right: 15px" mat-button color="accent" matStepperPrevious>Back</button>
          <button style="margin-right: 15px" mat-flat-button color="accent" [disabled]="disableForm" (click)="saveQuery()">Save</button>
        </div>
      </form>
    </mat-step>
  </mat-horizontal-stepper>
