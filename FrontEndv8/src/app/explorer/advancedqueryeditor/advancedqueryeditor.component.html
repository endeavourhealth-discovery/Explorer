  <div mat-dialog-title>
    Advanced query and data set editor
  </div>

  <mat-horizontal-stepper #stepper style="font-size: 14px">

    <mat-step [stepControl]="firstFormGroup" errorMessage="Step not completed.">
      <form [formGroup]="firstFormGroup">
        <ng-template matStepLabel>Query name</ng-template>
        <br/>
        <div class="summary-column">
          <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <mat-form-field appearance="outline" style="margin-left: 25px; width: 400px">
              <mat-label>Query category</mat-label>
              <input required matInput placeholder="Category" [(ngModel)]="type" formControlName="control1" (ngModelChange)="formChanged()" (keydown.enter)="stepper.next()">
            </mat-form-field>
          </div>
          <br/>
          <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <mat-form-field appearance="outline" style="margin-left: 25px; width: 400px">
              <mat-label>Query name</mat-label>
              <input required matInput placeholder="Name" [(ngModel)]="name" formControlName="control2" (ngModelChange)="formChanged()" (keydown.enter)="stepper.next()">
            </mat-form-field>
          </div>
          <br/>
          <span style="margin-left: 30px">*Required</span>
        </div>
        <div class="summary-column">
          <div style="margin-top: 7px" class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <p>Category of query for grouping in the library.</p>
          </div>
          <div style="margin-top: 30px" class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <p>Name of query.</p>
          </div>
        </div>
        <div style="margin-top: 375px" mat-dialog-actions align="end">
          <button style="margin-right: 15px" mat-button color="accent" (click)="onCancelClick()">Cancel</button>
          <button style="margin-right: 15px" mat-flat-button color="accent" (click)="stepper.next()">Next</button>
        </div>
      </form>
    </mat-step>

    <mat-step [stepControl]="secondFormGroup" errorMessage="Step not completed.">
      <form [formGroup]="secondFormGroup">
        <ng-template matStepLabel>Cohort definition</ng-template>
        <br/>
        <div class="summary-column">
          <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <mat-form-field appearance="outline" style="margin-left: 25px; width: 500px">
              <mat-label>Provider organisations</mat-label>
              <mat-select multiple [(ngModel)]="selectedOrganisation" formControlName="control3" (ngModelChange)="formChanged()" required>
                <mat-option *ngFor="let result of orgList" [value]="result">{{result}}</mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <br/>
          <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <mat-form-field appearance="outline" style="margin-left: 25px; width: 500px">
              <mat-label>Included organisations</mat-label>
              <mat-select multiple [(ngModel)]="selectedIncludedOrganisation" formControlName="control17" (ngModelChange)="formChanged()">
                <mat-option *ngFor="let result of orgIncList" [value]="result">{{result}}</mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <br/>
          <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <mat-form-field appearance="outline" style="margin-left: 25px; width: 500px">
              <mat-label>Patient GP registration status</mat-label>
              <mat-select [(ngModel)]="selectedRegistration" formControlName="control4" (ngModelChange)="formChanged()" required>
                <mat-option *ngFor="let registration of registrations" [value]="registration.regValue">
                  {{registration.regValue}}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <br/>
          <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <mat-form-field appearance="outline" style="margin-left: 25px; width: 500px">
              <mat-label>Cohort value set</mat-label>
              <mat-select multiple [(ngModel)]="selectedCohortValueSet" formControlName="control5" (ngModelChange)="formChanged()">
                <mat-select-search [formControl]="filterCtrl"></mat-select-search>
                <mat-option *ngFor="let result of filteredValueset | async" [value]="result" matTooltipClass="tooltip" matTooltipPosition="right" matTooltip="{{result}}">
                  {{result}}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <br/>

          <div class="flex" fxLayout.xs="column"  fxLayoutAlign="start">
            <mat-form-field class="example-full-width" appearance="outline" style="margin-left: 25px; width: 140px">
              <mat-label>Date range from</mat-label>
              <input matInput [matDatepicker]="valuepicker1" placeholder="Date from" [(ngModel)]="valueDateFrom" formControlName="control20">
              <mat-datepicker-toggle matSuffix [for]="valuepicker1">
                <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
              </mat-datepicker-toggle>
              <mat-datepicker #valuepicker1></mat-datepicker>
            </mat-form-field>

            <mat-form-field class="example-full-width" appearance="outline" style="margin-left: 20px; width: 140px">
              <mat-label>Date range to</mat-label>
              <input matInput [matDatepicker]="valuepicker2" placeholder="Date to" [(ngModel)]="valueDateTo" formControlName="control21">
              <mat-datepicker-toggle matSuffix [for]="valuepicker2">
                <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
              </mat-datepicker-toggle>
              <mat-datepicker #valuepicker2></mat-datepicker>
            </mat-form-field>
          </div>

          <br/>
          <div class="flex" fxLayout.xs="column"  fxLayoutAlign="start">
            <mat-form-field appearance="outline" style="margin-left: 25px; width: 140px">
              <mat-label>Age range from</mat-label>
              <input matInput placeholder="Age" [(ngModel)]="ageFrom" formControlName="control6" (keydown.enter)="stepper.next()">
            </mat-form-field>

            <mat-form-field appearance="outline" style="margin-left: 20px; width: 140px">
              <mat-label>Age range to</mat-label>
              <input matInput placeholder="Age" [(ngModel)]="ageTo" formControlName="control7" (keydown.enter)="stepper.next()">
            </mat-form-field>
          </div>
          <br/>
          <div class="flex" fxLayout.xs="column"  fxLayoutAlign="start">
            <mat-form-field appearance="outline" style="margin-left: 25px; width: 100px">
              <mat-label>Gender</mat-label>
              <mat-select [(ngModel)]="selectedGender" formControlName="control8">
                <mat-option *ngFor="let gender of genders" [value]="gender.genValue">
                  {{gender.genValue}}
                </mat-option>
              </mat-select>
            </mat-form-field>

            <mat-form-field appearance="outline" style="margin-left: 20px; width: 180px">
              <mat-label>Home address postcode</mat-label>
              <input matInput placeholder="Postcode" [(ngModel)]="postcode" formControlName="control9" (keydown.enter)="stepper.next()">
            </mat-form-field>
          </div>
          <br/>
          <span style="margin-left: 30px">*Required</span>
        </div>

        <div class="summary-column">
          <div style="margin-top: 14px" class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            List of organisations, or list of organisation groups, whose records will be used as the base cohort.
          </div>

          <div style="margin-top: 24px" class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            This is the list of organisations whose records are included for the patients in the base cohort. For example, patients who have records in a GP practice might be in the cohort base, they might have visited hospital and the hospital could also be included in the included organisation list. If an organisation is not defined, those organisations records are not included.
          </div>

          <div style="margin-top: 35px" class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            Limit the cohort by patient registration status.
          </div>

          <div style="margin-top: 50px" class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            Limit the cohort to only include patients that have clinical events, medication or encounters containing concepts that are part of the selected value set(s).
          </div>

          <div style="margin-top: 60px" class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            Filter the value set by date range.
          </div>

          <div style="margin-top: 57px" class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            Limit the cohort by age range.
          </div>

          <div style="margin-top: 57px" class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            Limit the cohort by gender and/or partial or full post code.
          </div>
        </div>

        <div mat-dialog-actions align="end">
          <button style="margin-right: 15px" mat-button color="accent" (click)="onCancelClick()">Cancel</button>
          <button style="margin-right: 15px" mat-button color="accent" matStepperPrevious>Back</button>
          <button style="margin-right: 15px" mat-flat-button color="accent" (click)="stepper.next()">Next</button>
        </div>
      </form>
    </mat-step>

    <mat-step [stepControl]="thirdFormGroup" errorMessage="Step not completed.">
      <form [formGroup]="thirdFormGroup">
        <ng-template matStepLabel>Advanced criteria</ng-template>
        <p style="font-weight: 500">Specify one or more of the following (optional) advanced criteria rules</p>
        <mat-divider></mat-divider>
        <br/>
        <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
          <mat-form-field appearance="standard" style="margin-left: 10px; width: 125px">
            <mat-label>Include/Exclude</mat-label>
            <mat-select [(ngModel)]="includedExclude1" formControlName="control22" (ngModelChange)="formChanged()">
              <mat-option *ngFor="let value of exclude" [value]="value.exclude">
                {{value.exclude}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <br/>
          <p style="margin-left: 10px; margin-top: 28px"><span style="color: blue">patients</span> if they have <span style="color: blue">entries</span> containing <span style="color: blue">concepts</span> that are part of</p>
          <mat-form-field appearance="standard" style="margin-left: 10px; width: 70px">
            <mat-label>Any/All</mat-label>
            <mat-select [(ngModel)]="includedAnyAll1" formControlName="control46" (ngModelChange)="formChanged()">
              <mat-option *ngFor="let value of anyAll" [value]="value.anyAll">
                {{value.anyAll}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <p style="margin-left: 10px; margin-top: 28px"> of the <span style="color: blue">value set(s)</span></p>
          <mat-form-field appearance="standard" style="width: 500px; margin-left: 10px">
            <mat-label>Cohort value set</mat-label>
            <mat-select multiple [(ngModel)]="includedValueSet1" formControlName="control23" (ngModelChange)="formChanged()">
              <mat-select-search [formControl]="filterCtrl"></mat-select-search>
              <mat-option *ngFor="let result of filteredValueset | async" [value]="result" matTooltipClass="tooltip" matTooltipPosition="right" matTooltip="{{result}}">
                {{result}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <br/>
          <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <p style="margin-left: 10px; margin-top: 28px"><span style="color: blue">within</span> the <span style="color: blue">time period</span></p>
            <mat-form-field class="example-full-width" appearance="standard" style="margin-left: 10px; width: 120px">
              <mat-label>Date from</mat-label>
              <input matInput [matDatepicker]="picker3" placeholder="Date from" [(ngModel)]="includedDateFrom1" formControlName="control24">
              <mat-datepicker-toggle matSuffix [for]="picker3">
                <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
              </mat-datepicker-toggle>
              <mat-datepicker #picker3></mat-datepicker>
            </mat-form-field>
            <p style="margin-left: 10px; margin-top: 28px">to</p>
            <mat-form-field class="example-full-width" appearance="standard" style="margin-left: 10px; width: 120px">
              <mat-label>Date to</mat-label>
              <input matInput [matDatepicker]="picker4" placeholder="Date to" [(ngModel)]="includedDateTo1" formControlName="control25">
              <mat-datepicker-toggle matSuffix [for]="picker4">
                <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
              </mat-datepicker-toggle>
              <mat-datepicker #picker4></mat-datepicker>
            </mat-form-field>
            <p style="margin-left: 10px; margin-top: 28px">or <span style="color: blue">within</span> the <span style="color: blue">last</span></p>
            <mat-form-field appearance="standard" style="margin-left: 10px; width: 60px">
              <mat-label>Period</mat-label>
              <input matInput placeholder="Value" [(ngModel)]="includedPeriodValue1" formControlName="control47" (keydown.enter)="stepper.next()">
            </mat-form-field>
            <mat-form-field appearance="standard" style="margin-left: 10px; width: 160px">
              <mat-label>Days/Weeks/Months</mat-label>
              <mat-select [(ngModel)]="includedPeriodType1" formControlName="control48" (ngModelChange)="formChanged()">
                <mat-option *ngFor="let value of period" [value]="value.period">
                  {{value.period}}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <div mat-dialog-actions style="margin-bottom: 10px; margin-left: 20px" *ngIf="addQuery1">
            <button mat-flat-button color="accent" (click)="addSameRule1()">Add same rule</button>
          </div>
        </div>

        <br/>
        <mat-divider></mat-divider>
        <br/>

        <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start" *ngIf="select1a">
          <mat-form-field appearance="standard" style="margin-left: 10px; width: 125px">
            <mat-label>Include/Exclude</mat-label>
            <mat-select [(ngModel)]="includedExclude1a" formControlName="control22a" (ngModelChange)="formChanged()">
              <mat-option *ngFor="let value of exclude" [value]="value.exclude">
                {{value.exclude}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <br/>
          <p style="margin-left: 10px; margin-top: 28px"><span style="color: blue">patients</span> if they have <span style="color: blue">entries</span> containing <span style="color: blue">concepts</span> that are part of</p>
          <mat-form-field appearance="standard" style="margin-left: 10px; width: 70px">
            <mat-label>Any/All</mat-label>
            <mat-select [(ngModel)]="includedAnyAll1a" formControlName="control46a" (ngModelChange)="formChanged()">
              <mat-option *ngFor="let value of anyAll" [value]="value.anyAll">
                {{value.anyAll}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <p style="margin-left: 10px; margin-top: 28px"> of the <span style="color: blue">value set(s)</span></p>
          <mat-form-field appearance="standard" style="width: 500px; margin-left: 10px">
            <mat-label>Cohort value set</mat-label>
            <mat-select multiple [(ngModel)]="includedValueSet1a" formControlName="control23a" (ngModelChange)="formChanged()">
              <mat-select-search [formControl]="filterCtrl"></mat-select-search>
              <mat-option *ngFor="let result of filteredValueset | async" [value]="result" matTooltipClass="tooltip" matTooltipPosition="right" matTooltip="{{result}}">
                {{result}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <br/>
          <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <p style="margin-left: 10px; margin-top: 28px"><span style="color: blue">within</span> the <span style="color: blue">time period</span></p>
            <mat-form-field class="example-full-width" appearance="standard" style="margin-left: 10px; width: 120px">
              <mat-label>Date from</mat-label>
              <input matInput [matDatepicker]="picker3a" placeholder="Date from" [(ngModel)]="includedDateFrom1a" formControlName="control24a">
              <mat-datepicker-toggle matSuffix [for]="picker3a">
                <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
              </mat-datepicker-toggle>
              <mat-datepicker #picker3a></mat-datepicker>
            </mat-form-field>
            <p style="margin-left: 10px; margin-top: 28px">to</p>
            <mat-form-field class="example-full-width" appearance="standard" style="margin-left: 10px; width: 120px">
              <mat-label>Date to</mat-label>
              <input matInput [matDatepicker]="picker4a" placeholder="Date to" [(ngModel)]="includedDateTo1a" formControlName="control25a">
              <mat-datepicker-toggle matSuffix [for]="picker4a">
                <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
              </mat-datepicker-toggle>
              <mat-datepicker #picker4a></mat-datepicker>
            </mat-form-field>
            <p style="margin-left: 10px; margin-top: 28px">or <span style="color: blue">within</span> the <span style="color: blue">last</span></p>
            <mat-form-field appearance="standard" style="margin-left: 10px; width: 60px">
              <mat-label>Period</mat-label>
              <input matInput placeholder="Value" [(ngModel)]="includedPeriodValue1a" formControlName="control47a" (keydown.enter)="stepper.next()">
            </mat-form-field>
            <mat-form-field appearance="standard" style="margin-left: 10px; width: 160px">
              <mat-label>Days/Weeks/Months</mat-label>
              <mat-select [(ngModel)]="includedPeriodType1a" formControlName="control48a" (ngModelChange)="formChanged()">
                <mat-option *ngFor="let value of period" [value]="value.period">
                  {{value.period}}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <div mat-dialog-actions style="margin-bottom: 10px; margin-left: 20px" *ngIf="addQuery1b">
            <button mat-flat-button color="accent" (click)="addSameRule1b()">Add same rule</button>
          </div>
        </div>

        <br *ngIf="select1a"/>
        <mat-divider *ngIf="select1a"></mat-divider>
        <br *ngIf="select1a"/>

        <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start" *ngIf="select1b">
          <mat-form-field appearance="standard" style="margin-left: 10px; width: 125px">
            <mat-label>Include/Exclude</mat-label>
            <mat-select [(ngModel)]="includedExclude1b" formControlName="control22b" (ngModelChange)="formChanged()">
              <mat-option *ngFor="let value of exclude" [value]="value.exclude">
                {{value.exclude}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <br/>
          <p style="margin-left: 10px; margin-top: 28px"><span style="color: blue">patients</span> if they have <span style="color: blue">entries</span> containing <span style="color: blue">concepts</span> that are part of</p>
          <mat-form-field appearance="standard" style="margin-left: 10px; width: 70px">
            <mat-label>Any/All</mat-label>
            <mat-select [(ngModel)]="includedAnyAll1b" formControlName="control46b" (ngModelChange)="formChanged()">
              <mat-option *ngFor="let value of anyAll" [value]="value.anyAll">
                {{value.anyAll}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <p style="margin-left: 10px; margin-top: 28px"> of the <span style="color: blue">value set(s)</span></p>
          <mat-form-field appearance="standard" style="width: 500px; margin-left: 10px">
            <mat-label>Cohort value set</mat-label>
            <mat-select multiple [(ngModel)]="includedValueSet1b" formControlName="control23b" (ngModelChange)="formChanged()">
              <mat-select-search [formControl]="filterCtrl"></mat-select-search>
              <mat-option *ngFor="let result of filteredValueset | async" [value]="result" matTooltipClass="tooltip" matTooltipPosition="right" matTooltip="{{result}}">
                {{result}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <br/>
          <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <p style="margin-left: 10px; margin-top: 28px"><span style="color: blue">within</span> the <span style="color: blue">time period</span></p>
            <mat-form-field class="example-full-width" appearance="standard" style="margin-left: 10px; width: 120px">
              <mat-label>Date from</mat-label>
              <input matInput [matDatepicker]="picker3b" placeholder="Date from" [(ngModel)]="includedDateFrom1b" formControlName="control24b">
              <mat-datepicker-toggle matSuffix [for]="picker3b">
                <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
              </mat-datepicker-toggle>
              <mat-datepicker #picker3b></mat-datepicker>
            </mat-form-field>
            <p style="margin-left: 10px; margin-top: 28px">to</p>
            <mat-form-field class="example-full-width" appearance="standard" style="margin-left: 10px; width: 120px">
              <mat-label>Date to</mat-label>
              <input matInput [matDatepicker]="picker4b" placeholder="Date to" [(ngModel)]="includedDateTo1b" formControlName="control25b">
              <mat-datepicker-toggle matSuffix [for]="picker4b">
                <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
              </mat-datepicker-toggle>
              <mat-datepicker #picker4b></mat-datepicker>
            </mat-form-field>
            <p style="margin-left: 10px; margin-top: 28px">or <span style="color: blue">within</span> the <span style="color: blue">last</span></p>
            <mat-form-field appearance="standard" style="margin-left: 10px; width: 60px">
              <mat-label>Period</mat-label>
              <input matInput placeholder="Value" [(ngModel)]="includedPeriodValue1b" formControlName="control47b" (keydown.enter)="stepper.next()">
            </mat-form-field>
            <mat-form-field appearance="standard" style="margin-left: 10px; width: 160px">
              <mat-label>Days/Weeks/Months</mat-label>
              <mat-select [(ngModel)]="includedPeriodType1b" formControlName="control48b" (ngModelChange)="formChanged()">
                <mat-option *ngFor="let value of period" [value]="value.period">
                  {{value.period}}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
        </div>

        <br *ngIf="select1b"/>
        <mat-divider *ngIf="select1b"></mat-divider>
        <br *ngIf="select1b"/>

        <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
          <mat-form-field appearance="standard" style="margin-left: 10px; width: 125px">
            <mat-label>Include/Exclude</mat-label>
            <mat-select [(ngModel)]="includedExclude2" formControlName="control26" (ngModelChange)="formChanged()">
              <mat-option *ngFor="let value of exclude" [value]="value.exclude">
                {{value.exclude}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <br/>
          <p style="margin-left: 10px; margin-top: 29px"><span style="color: blue">patients</span> if they have <span style="color: blue">entries</span> containing <span style="color: blue">concepts</span> that are part of</p>
          <mat-form-field appearance="standard" style="margin-left: 10px; width: 70px">
            <mat-label>Any/All</mat-label>
            <mat-select [(ngModel)]="includedAnyAll2" formControlName="control49" (ngModelChange)="formChanged()">
              <mat-option *ngFor="let value of anyAll" [value]="value.anyAll">
                {{value.anyAll}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <p style="margin-left: 10px; margin-top: 28px"> of the <span style="color: blue">value set(s)</span></p>
          <mat-form-field appearance="standard" style="width: 500px; margin-left: 10px">
            <mat-label>Cohort value set</mat-label>
            <mat-select multiple [(ngModel)]="includedValueSet2" formControlName="control27" (ngModelChange)="formChanged()">
              <mat-select-search [formControl]="filterCtrl"></mat-select-search>
              <mat-option *ngFor="let result of filteredValueset | async" [value]="result" matTooltipClass="tooltip" matTooltipPosition="right" matTooltip="{{result}}">
                {{result}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <br/>
          <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <p style="margin-left: 10px; margin-top: 29px">and the <span style="color: blue">value</span> of the</p>
            <mat-form-field appearance="standard" style="margin-left: 10px; width: 120px">
              <mat-label>Earliest/Latest</mat-label>
              <mat-select [(ngModel)]="includedEarliestLatest2" formControlName="control28" (ngModelChange)="formChanged()">
                <mat-option *ngFor="let value of earliestLatest" [value]="value.earliestLatest">
                  {{value.earliestLatest}}
                </mat-option>
              </mat-select>
            </mat-form-field>
              <p style="margin-left: 10px; margin-top: 28px"><span style="color: blue">entry</span> is</p>
            <mat-form-field appearance="standard" style="margin-left: 10px; width: 110px">
              <mat-label>Less/Greater</mat-label>
              <mat-select [(ngModel)]="includedOperator2" formControlName="control29" (ngModelChange)="formChanged()">
                <mat-option *ngFor="let value of operator" [value]="value.operator">
                  {{value.operator}}
                </mat-option>
              </mat-select>
            </mat-form-field>
            <mat-form-field appearance="standard" style="margin-left: 10px; width: 100px">
              <mat-label>Entry value</mat-label>
              <input matInput placeholder="Value" [(ngModel)]="includedEntryValue2" formControlName="control30" (keydown.enter)="stepper.next()">
            </mat-form-field>
          </div>
          <br/>
          <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <p style="margin-left: 10px; margin-top: 28px">within the <span style="color: blue">time period</span></p>
            <mat-form-field class="example-full-width" appearance="standard" style="margin-left: 10px; width: 120px">
              <mat-label>Date from</mat-label>
              <input matInput [matDatepicker]="picker9" placeholder="Date from" [(ngModel)]="includedDateFrom2" formControlName="control61">
              <mat-datepicker-toggle matSuffix [for]="picker9">
                <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
              </mat-datepicker-toggle>
              <mat-datepicker #picker9></mat-datepicker>
            </mat-form-field>
            <p style="margin-left: 10px; margin-top: 28px">to</p>
            <mat-form-field class="example-full-width" appearance="standard" style="margin-left: 10px; width: 120px">
              <mat-label>Date to</mat-label>
              <input matInput [matDatepicker]="picker10" placeholder="Date to" [(ngModel)]="includedDateTo2" formControlName="control62">
              <mat-datepicker-toggle matSuffix [for]="picker10">
                <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
              </mat-datepicker-toggle>
              <mat-datepicker #picker10></mat-datepicker>
            </mat-form-field>
            <br/>
            <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
              <p style="margin-left: 10px; margin-top: 28px">or <span style="color: blue">within the last</span></p>
              <mat-form-field appearance="standard" style="margin-left: 10px; width: 60px">
                <mat-label>Period</mat-label>
                <input matInput placeholder="Value" [(ngModel)]="includedPeriodValue2" formControlName="control63" (keydown.enter)="stepper.next()">
              </mat-form-field>
              <mat-form-field appearance="standard" style="margin-left: 10px; width: 160px">
                <mat-label>Days/Weeks/Months</mat-label>
                <mat-select [(ngModel)]="includedPeriodType2" formControlName="control64" (ngModelChange)="formChanged()">
                  <mat-option *ngFor="let value of period" [value]="value.period">
                    {{value.period}}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
          </div>

          <div mat-dialog-actions style="margin-bottom: 10px; margin-left: 20px" *ngIf="addQuery2">
            <button mat-flat-button color="accent" (click)="addSameRule2()">Add same rule</button>
          </div>
        </div>

        <br/>
        <mat-divider></mat-divider>
        <br/>

        <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start" *ngIf="select2a">
          <mat-form-field appearance="standard" style="margin-left: 10px; width: 125px">
            <mat-label>Include/Exclude</mat-label>
            <mat-select [(ngModel)]="includedExclude2a" formControlName="control26a" (ngModelChange)="formChanged()">
              <mat-option *ngFor="let value of exclude" [value]="value.exclude">
                {{value.exclude}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <br/>
          <p style="margin-left: 10px; margin-top: 29px"><span style="color: blue">patients</span> if they have <span style="color: blue">entries</span> containing <span style="color: blue">concepts</span> that are part of</p>
          <mat-form-field appearance="standard" style="margin-left: 10px; width: 70px">
            <mat-label>Any/All</mat-label>
            <mat-select [(ngModel)]="includedAnyAll2a" formControlName="control50" (ngModelChange)="formChanged()">
              <mat-option *ngFor="let value of anyAll" [value]="value.anyAll">
                {{value.anyAll}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <p style="margin-left: 10px; margin-top: 28px"> of the <span style="color: blue">value set(s)</span></p>
          <mat-form-field appearance="standard" style="width: 500px; margin-left: 10px">
            <mat-label>Cohort value set</mat-label>
            <mat-select multiple [(ngModel)]="includedValueSet2a" formControlName="control27a" (ngModelChange)="formChanged()">
              <mat-select-search [formControl]="filterCtrl"></mat-select-search>
              <mat-option *ngFor="let result of filteredValueset | async" [value]="result" matTooltipClass="tooltip" matTooltipPosition="right" matTooltip="{{result}}">
                {{result}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <br/>
          <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <p style="margin-left: 10px; margin-top: 28px">and the <span style="color: blue">value</span> of the</p>
            <mat-form-field appearance="standard" style="margin-left: 10px; width: 120px">
              <mat-label>Earliest/Latest</mat-label>
              <mat-select [(ngModel)]="includedEarliestLatest2a" formControlName="control28a" (ngModelChange)="formChanged()">
                <mat-option *ngFor="let value of earliestLatest" [value]="value.earliestLatest">
                  {{value.earliestLatest}}
                </mat-option>
              </mat-select>
            </mat-form-field>
            <p style="margin-left: 10px; margin-top: 28px"><span style="color: blue">entry</span> is</p>
            <mat-form-field appearance="standard" style="margin-left: 10px; width: 110px">
              <mat-label>Less/Greater</mat-label>
              <mat-select [(ngModel)]="includedOperator2a" formControlName="control29a" (ngModelChange)="formChanged()">
                <mat-option *ngFor="let value of operator" [value]="value.operator">
                  {{value.operator}}
                </mat-option>
              </mat-select>
            </mat-form-field>
            <mat-form-field appearance="standard" style="margin-left: 10px; width: 100px">
              <mat-label>Entry value</mat-label>
              <input matInput placeholder="Value" [(ngModel)]="includedEntryValue2a" formControlName="control30a" (keydown.enter)="stepper.next()">
            </mat-form-field>
          </div>
          <br/>
          <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <p style="margin-left: 10px; margin-top: 28px">within the <span style="color: blue">time period</span></p>
            <mat-form-field class="example-full-width" appearance="standard" style="margin-left: 10px; width: 120px">
              <mat-label>Date from</mat-label>
              <input matInput [matDatepicker]="picker9a" placeholder="Date from" [(ngModel)]="includedDateFrom2a" formControlName="control61a">
              <mat-datepicker-toggle matSuffix [for]="picker9a">
                <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
              </mat-datepicker-toggle>
              <mat-datepicker #picker9a></mat-datepicker>
            </mat-form-field>
            <p style="margin-left: 10px; margin-top: 28px">to</p>
            <mat-form-field class="example-full-width" appearance="standard" style="margin-left: 10px; width: 120px">
              <mat-label>Date to</mat-label>
              <input matInput [matDatepicker]="picker10a" placeholder="Date to" [(ngModel)]="includedDateTo2a" formControlName="control62a">
              <mat-datepicker-toggle matSuffix [for]="picker10a">
                <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
              </mat-datepicker-toggle>
              <mat-datepicker #picker10a></mat-datepicker>
            </mat-form-field>
            <br/>
            <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
              <p style="margin-left: 10px; margin-top: 28px">or <span style="color: blue">within the last</span></p>
              <mat-form-field appearance="standard" style="margin-left: 10px; width: 60px">
                <mat-label>Period</mat-label>
                <input matInput placeholder="Value" [(ngModel)]="includedPeriodValue2a" formControlName="control63a" (keydown.enter)="stepper.next()">
              </mat-form-field>
              <mat-form-field appearance="standard" style="margin-left: 10px; width: 160px">
                <mat-label>Days/Weeks/Months</mat-label>
                <mat-select [(ngModel)]="includedPeriodType2a" formControlName="control64a" (ngModelChange)="formChanged()">
                  <mat-option *ngFor="let value of period" [value]="value.period">
                    {{value.period}}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
          </div>
        </div>

        <br *ngIf="select2a"/>
        <mat-divider *ngIf="select2a"></mat-divider>
        <br *ngIf="select2a"/>

        <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
          <mat-form-field appearance="standard" style="margin-left: 10px; width: 125px">
            <mat-label>Include/Exclude</mat-label>
            <mat-select [(ngModel)]="includedExclude3" formControlName="control31" (ngModelChange)="formChanged()">
              <mat-option *ngFor="let value of exclude" [value]="value.exclude">
                {{value.exclude}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <p style="margin-left: 10px; margin-top: 28px"><span style="color: blue">patients</span> if they have <span style="color: blue">entries</span> containing <span style="color: blue">concepts</span> that are part of</p>
          <mat-form-field appearance="standard" style="margin-left: 10px; width: 70px">
            <mat-label>Any/All</mat-label>
            <mat-select [(ngModel)]="includedAnyAll3" formControlName="control51" (ngModelChange)="formChanged()">
              <mat-option *ngFor="let value of anyAll" [value]="value.anyAll">
                {{value.anyAll}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <p style="margin-left: 10px; margin-top: 28px"> of the <span style="color: blue">value set(s)</span></p>
          <mat-form-field appearance="standard" style="width: 500px; margin-left: 10px">
            <mat-label>Cohort value set</mat-label>
            <mat-select multiple [(ngModel)]="includedValueSet3" formControlName="control32" (ngModelChange)="formChanged()">
              <mat-select-search [formControl]="filterCtrl"></mat-select-search>
              <mat-option *ngFor="let result of filteredValueset | async" [value]="result" matTooltipClass="tooltip" matTooltipPosition="right" matTooltip="{{result}}">
                {{result}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <br/>
          <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <p style="margin-left: 10px; margin-top: 28px">and the <span style="color: blue">value</span> of the</p>
            <mat-form-field appearance="standard" style="margin-left: 10px; width: 120px">
              <mat-label>Earliest/Latest</mat-label>
              <mat-select [(ngModel)]="includedEarliestLatest3" formControlName="control33" (ngModelChange)="formChanged()">
                <mat-option *ngFor="let value of earliestLatest" [value]="value.earliestLatest">
                  {{value.earliestLatest}}
                </mat-option>
              </mat-select>
            </mat-form-field>
            <p style="margin-left: 10px; margin-top: 28px"><span style="color: blue">entry concept</span> is</p>
            <mat-form-field appearance="standard" style="margin-left: 10px; width: 70px">
              <mat-label>Any/All</mat-label>
              <mat-select [(ngModel)]="includedAnyAllTested3" formControlName="control52" (ngModelChange)="formChanged()">
                <mat-option *ngFor="let value of anyAll" [value]="value.anyAll">
                  {{value.anyAll}}
                </mat-option>
              </mat-select>
            </mat-form-field>
            <p style="margin-left: 10px; margin-top: 28px">of</p>
            <mat-form-field appearance="standard" style="width: 500px; margin-left: 10px">
              <mat-label>Cohort value set</mat-label>
              <mat-select multiple [(ngModel)]="includedTestedValueSet3" formControlName="control34" (ngModelChange)="formChanged()">
                <mat-select-search [formControl]="filterCtrl"></mat-select-search>
                <mat-option *ngFor="let result of filteredValueset | async" [value]="result" matTooltipClass="tooltip" matTooltipPosition="right" matTooltip="{{result}}">
                  {{result}}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
        </div>

        <br/>
        <mat-divider></mat-divider>
        <br/>

        <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
          <mat-form-field appearance="standard" style="margin-left: 10px; width: 125px">
            <mat-label>Include/Exclude</mat-label>
            <mat-select [(ngModel)]="includedExclude4" formControlName="control35" (ngModelChange)="formChanged()">
              <mat-option *ngFor="let value of exclude" [value]="value.exclude">
                {{value.exclude}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <p style="margin-left: 10px; margin-top: 28px"><span style="color: blue">patients</span> if they have <span style="color: blue">entries</span> containing <span style="color: blue">concepts</span> that are part of</p>
          <mat-form-field appearance="standard" style="margin-left: 10px; width: 70px">
            <mat-label>Any/All</mat-label>
            <mat-select [(ngModel)]="includedAnyAll4" formControlName="control53" (ngModelChange)="formChanged()">
              <mat-option *ngFor="let value of anyAll" [value]="value.anyAll">
                {{value.anyAll}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <p style="margin-left: 10px; margin-top: 28px">of the <span style="color: blue">value set(s)</span></p>
          <mat-form-field appearance="standard" style="width: 500px; margin-left: 10px">
            <mat-label>Cohort value set</mat-label>
            <mat-select multiple [(ngModel)]="includedValueSet4" formControlName="control36" (ngModelChange)="formChanged()">
              <mat-select-search [formControl]="filterCtrl"></mat-select-search>
              <mat-option *ngFor="let result of filteredValueset | async" [value]="result" matTooltipClass="tooltip" matTooltipPosition="right" matTooltip="{{result}}">
                {{result}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <p style="margin-left: 10px; margin-top: 28px; display: inline">and those <span style="color: blue">entries</span></p>
          <mat-form-field appearance="standard" style="width: 100px; margin-left: 10px">
            <mat-label>Are/Are not</mat-label>
            <mat-select multiple [(ngModel)]="includedAreNot4 " formControlName="control54" (ngModelChange)="formChanged()">
              <mat-option *ngFor="let value of areNot" [value]="value.areNot">
                {{value.areNot}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <p style="margin-left: 10px; margin-top: 28px; display: inline"><span style="color: blue">followed</span> by <span style="color: blue">entries</span> containing <span style="color: blue">concepts</span> that are part of</p>
          <mat-form-field appearance="standard" style="margin-left: 10px; width: 70px">
            <mat-label>Any/All</mat-label>
            <mat-select [(ngModel)]="includedAnyAllFollowedBy4" formControlName="control55" (ngModelChange)="formChanged()">
              <mat-option *ngFor="let value of anyAll" [value]="value.anyAll">
                {{value.anyAll}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <p style="margin-left: 10px; margin-top: 28px">of the <span style="color: blue">value set(s)</span></p>
          <mat-form-field appearance="standard" style="width: 500px; margin-left: 10px">
            <mat-label>Cohort value set</mat-label>
            <mat-select multiple [(ngModel)]="includedFollowedByValueSet4" formControlName="control37" (ngModelChange)="formChanged()">
              <mat-select-search [formControl]="filterCtrl"></mat-select-search>
              <mat-option *ngFor="let result of filteredValueset | async" [value]="result" matTooltipClass="tooltip" matTooltipPosition="right" matTooltip="{{result}}">
                {{result}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <br/>
          <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <p style="margin-left: 10px; margin-top: 28px">within the <span style="color: blue">time period</span></p>
            <mat-form-field class="example-full-width" appearance="standard" style="margin-left: 10px; width: 120px">
              <mat-label>Date from</mat-label>
              <input matInput [matDatepicker]="picker5" placeholder="Date from" [(ngModel)]="includedDateFrom4" formControlName="control59">
              <mat-datepicker-toggle matSuffix [for]="picker5">
                <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
              </mat-datepicker-toggle>
              <mat-datepicker #picker5></mat-datepicker>
            </mat-form-field>
            <p style="margin-left: 10px; margin-top: 28px">to</p>
            <mat-form-field class="example-full-width" appearance="standard" style="margin-left: 10px; width: 120px">
              <mat-label>Date to</mat-label>
              <input matInput [matDatepicker]="picker6" placeholder="Date to" [(ngModel)]="includedDateTo4" formControlName="control60">
              <mat-datepicker-toggle matSuffix [for]="picker6">
                <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
              </mat-datepicker-toggle>
              <mat-datepicker #picker6></mat-datepicker>
            </mat-form-field>
            <br/>
            <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
              <p style="margin-left: 10px; margin-top: 28px">or <span style="color: blue">within the last</span></p>
              <mat-form-field appearance="standard" style="margin-left: 10px; width: 60px">
                <mat-label>Period</mat-label>
                <input matInput placeholder="Value" [(ngModel)]="includedPeriodValue4" formControlName="control38" (keydown.enter)="stepper.next()">
              </mat-form-field>
              <mat-form-field appearance="standard" style="margin-left: 10px; width: 160px">
                <mat-label>Days/Weeks/Months</mat-label>
                <mat-select [(ngModel)]="includedPeriodType4" formControlName="control39" (ngModelChange)="formChanged()">
                  <mat-option *ngFor="let value of period" [value]="value.period">
                    {{value.period}}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
          </div>
        </div>

        <br/>
        <mat-divider></mat-divider>
        <br/>

        <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
          <mat-form-field appearance="standard" style="margin-left: 10px; width: 125px">
            <mat-label>Include/Exclude</mat-label>
            <mat-select [(ngModel)]="includedExclude5" formControlName="control40" (ngModelChange)="formChanged()">
              <mat-option *ngFor="let value of exclude" [value]="value.exclude">
                {{value.exclude}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <p style="margin-left: 10px; margin-top: 28px"><span style="color: blue">patients</span> if they have <span style="color: blue">entries</span> containing <span style="color: blue">concepts</span> that are part of</p>
          <mat-form-field appearance="standard" style="margin-left: 10px; width: 70px">
            <mat-label>Any/All</mat-label>
            <mat-select [(ngModel)]="includedAnyAll5" formControlName="control56" (ngModelChange)="formChanged()">
              <mat-option *ngFor="let value of anyAll" [value]="value.anyAll">
                {{value.anyAll}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <p style="margin-left: 10px; margin-top: 28px">of the <span style="color: blue">value set(s)</span></p>
          <mat-form-field appearance="standard" style="width: 500px; margin-left: 10px">
            <mat-label>Cohort value set</mat-label>
            <mat-select multiple [(ngModel)]="includedValueSet5" formControlName="control41" (ngModelChange)="formChanged()">
              <mat-select-search [formControl]="filterCtrl"></mat-select-search>
              <mat-option *ngFor="let result of filteredValueset | async" [value]="result" matTooltipClass="tooltip" matTooltipPosition="right" matTooltip="{{result}}">
                {{result}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <br/>
          <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <p style="margin-left: 10px; margin-top: 28px">and there are</p>
            <mat-form-field appearance="standard" style="margin-left: 10px; width: 110px">
              <mat-label>Less/Greater</mat-label>
              <mat-select [(ngModel)]="includedOperator5" formControlName="control42" (ngModelChange)="formChanged()">
                <mat-option *ngFor="let value of operator" [value]="value.operator">
                  {{value.operator}}
                </mat-option>
              </mat-select>
            </mat-form-field>
            <mat-form-field appearance="standard" style="margin-left: 10px; width: 60px">
              <mat-label>Value</mat-label>
              <input matInput placeholder="Value" [(ngModel)]="includedEntryValue5" formControlName="control43" (keydown.enter)="stepper.next()">
            </mat-form-field>
            <p style="margin-left: 10px; margin-top: 28px"><span style="color: blue">occurrences</span> of these <span style="color: blue">concepts</span>
            <br/>
            <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
              <p style="margin-left: 10px; margin-top: 28px">within the <span style="color: blue">time period</span></p>
              <mat-form-field class="example-full-width" appearance="standard" style="margin-left: 10px; width: 120px">
                <mat-label>Date from</mat-label>
                <input matInput [matDatepicker]="picker7" placeholder="Date from" [(ngModel)]="includedDateFrom5" formControlName="control44">
                <mat-datepicker-toggle matSuffix [for]="picker7">
                  <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
                </mat-datepicker-toggle>
                <mat-datepicker #picker7></mat-datepicker>
              </mat-form-field>
              <p style="margin-left: 10px; margin-top: 28px">to</p>
              <mat-form-field class="example-full-width" appearance="standard" style="margin-left: 10px; width: 120px">
                <mat-label>Date to</mat-label>
                <input matInput [matDatepicker]="picker8" placeholder="Date to" [(ngModel)]="includedDateTo5" formControlName="control45">
                <mat-datepicker-toggle matSuffix [for]="picker8">
                  <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
                </mat-datepicker-toggle>
                <mat-datepicker #picker8></mat-datepicker>
              </mat-form-field>
              <br/>
              <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
                <p style="margin-left: 10px; margin-top: 28px">or <span style="color: blue">within the last</span></p>
                <mat-form-field appearance="standard" style="margin-left: 10px; width: 60px">
                  <mat-label>Period</mat-label>
                  <input matInput placeholder="Value" [(ngModel)]="includedPeriodValue5" formControlName="control57" (keydown.enter)="stepper.next()">
                </mat-form-field>
                <mat-form-field appearance="standard" style="margin-left: 10px; width: 160px">
                  <mat-label>Days/Weeks/Months</mat-label>
                  <mat-select [(ngModel)]="includedPeriodType5" formControlName="control58" (ngModelChange)="formChanged()">
                    <mat-option *ngFor="let value of period" [value]="value.period">
                      {{value.period}}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
            </div>
          </div>
        </div>
        <div mat-dialog-actions align="end">
          <button style="margin-right: 15px" mat-button color="accent" (click)="onCancelClick()">Cancel</button>
          <button style="margin-right: 15px" mat-button color="accent" matStepperPrevious>Back</button>
          <button style="margin-right: 15px" mat-flat-button color="accent" (click)="stepper.next()">Next</button>
        </div>
      </form>
    </mat-step>

    <mat-step [stepControl]="fourthFormGroup" errorMessage="Step not completed.">
      <form [formGroup]="fourthFormGroup">
        <ng-template matStepLabel>Data set criteria</ng-template>
        <br/>

        <div class="summary-column">
          <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <mat-form-field appearance="outline" style="margin-left: 25px; width: 500px">
              <mat-label>Included event types</mat-label>
              <mat-select multiple [(ngModel)]="selectedEventType" formControlName="control10" (ngModelChange)="formChanged()" required>
                <mat-option *ngFor="let eventType of eventTypes" [value]="eventType.value">
                  {{eventType.value}}
                </mat-option>
              </mat-select>
            </mat-form-field>

            <div style="margin-left: 25px; width: 235px">
              <br/>
              <mat-checkbox class="checkbox" [(ngModel)]="active" formControlName="control13">Active items only</mat-checkbox>
            </div>
          </div>
          <br/>
          <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <mat-form-field appearance="outline" style="margin-left: 25px; width: 500px">
              <mat-label>Dataset value set</mat-label>
              <mat-select multiple [(ngModel)]="selectedDatasetValueSet" formControlName="control16" (ngModelChange)="formChanged()">
                <mat-select-search [formControl]="filterCtrl"></mat-select-search>
                <mat-option *ngFor="let result of filteredValueset | async" [value]="result" matTooltipClass="tooltip" matTooltipPosition="right" matTooltip="{{result}}">
                  {{result}}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <br/>
          <div class="flex" fxLayout.xs="column"  fxLayoutAlign="start">
            <mat-form-field class="example-full-width" appearance="outline" style="margin-left: 25px">
              <mat-label>Date range from</mat-label>
              <input matInput [matDatepicker]="picker1" placeholder="Date from" [(ngModel)]="dateFrom" formControlName="control11">
              <mat-datepicker-toggle matSuffix [for]="picker1">
                <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
              </mat-datepicker-toggle>
              <mat-datepicker #picker1></mat-datepicker>
            </mat-form-field>

            <mat-form-field class="example-full-width" appearance="outline" style="margin-left: 25px">
              <mat-label>Date range to</mat-label>
              <input matInput [matDatepicker]="picker2" placeholder="Date to" [(ngModel)]="dateTo" formControlName="control12">
              <mat-datepicker-toggle matSuffix [for]="picker2">
                <mat-icon matDatepickerToggleIcon>keyboard_arrow_down</mat-icon>
              </mat-datepicker-toggle>
              <mat-datepicker #picker2></mat-datepicker>
            </mat-form-field>
          </div>
          <br/>
          <span style="margin-left: 30px">*Required</span>
        </div>

        <div class="summary-column">
          <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start" style="margin-top: -8px">
            <p>Clinical events include conditions, values, procedures, immunisations, family history, referrals, and allergies. Encounters include consultations, admissions, discharges, and outpatient attendances.</p>
          </div>

          <div style="margin-top: 53px" class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <p>Filter data set by the selected value sets.</p>
          </div>

          <div style="margin-top: 30px" class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <p>Filter the data set by date range.</p>
          </div>
        </div>

        <div style="margin-top: 300px" mat-dialog-actions align="end">
          <button style="margin-right: 15px" mat-button color="accent" (click)="onCancelClick()">Cancel</button>
          <button style="margin-right: 15px" mat-button color="accent" matStepperPrevious>Back</button>
          <button style="margin-right: 15px" mat-flat-button color="accent" (click)="stepper.next()">Next</button>
        </div>
      </form>
    </mat-step>

    <mat-step [stepControl]="fifthFormGroup" errorMessage="Step not completed.">
      <form [formGroup]="fifthFormGroup">
        <ng-template matStepLabel>Data set output definition</ng-template>
        <br/>

        <div class="summary-column">
          <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <mat-form-field appearance="outline" style="margin-left: 25px">
              <mat-label>Output fields</mat-label>
              <mat-select multiple [(ngModel)]="selectedOutputField" formControlName="control14" (ngModelChange)="formChanged()">
                <mat-option *ngFor="let field of outputFields" [value]="field.outputField">
                  {{field.outputField}}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <br/>
          <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <mat-form-field appearance="outline" style="margin-left: 25px">
              <mat-label>Output type</mat-label>
              <mat-select [(ngModel)]="selectedOutputType" formControlName="control15" (ngModelChange)="formChanged()" required>
                <mat-option *ngFor="let outputType of outputTypes" [value]="outputType.outputType">
                  {{outputType.outputType}}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <br/>
          <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <mat-form-field appearance="outline" style="margin-left: 25px">
              <mat-label>Refresh schedule</mat-label>
              <mat-select [(ngModel)]="selectedSchedule" formControlName="control18" (ngModelChange)="formChanged()" required>
                <mat-option *ngFor="let schedule of schedules" [value]="schedule.scheduleValue">
                  {{schedule.scheduleValue}}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <br/>
          <div class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <mat-form-field appearance="outline" style="margin-left: 25px">
              <mat-label>Delivery mechanism</mat-label>
              <mat-select [(ngModel)]="selectedDelivery" formControlName="control19" (ngModelChange)="formChanged()" required>
                <mat-option *ngFor="let delivery of deliveries" [value]="delivery.deliveryValue">
                  {{delivery.deliveryValue}}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <br/>
          <span style="margin-left: 30px">*Required</span>
        </div>

        <div class="summary-column">
          <div style="margin-top: 8px" class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <p>Output fields. Fields for comparing/aggregating/grouping in dashboards or fields to be output as rows in tables.</p>
          </div>
          <div style="margin-top: 29px" class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <p>Output type for visualisations or exporting to files.</p>
          </div>
          <div style="margin-top: 30px" class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <p>How often should this data set be refreshed.</p>
          </div>
          <div style="margin-top: 30px" class="flex" fxLayout="row wrap" fxLayout.xs="column"  fxLayoutAlign="start">
            <p>The mechanism that is used to deliver the report.</p>
          </div>
        </div>

        <div style="margin-top: 225px" mat-dialog-actions align="end">
          <button style="margin-right: 15px" mat-button color="accent" (click)="onCancelClick()">Cancel</button>
          <button style="margin-right: 15px" mat-button color="accent" matStepperPrevious>Back</button>
          <button style="margin-right: 15px" mat-flat-button color="accent" [disabled]="disableForm" (click)="saveQuery()">Save</button>
        </div>
      </form>
    </mat-step>
  </mat-horizontal-stepper>
